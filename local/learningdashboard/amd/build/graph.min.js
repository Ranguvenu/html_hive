define(['jquery', 'core/str', 'core/ajax', 'highcharts'], function($, str, ajax, Highcharts) {
    let dataset, chart, completionPercentage;
    function getData() {
        console.log("dataset dataset dataset:", dataset.data);
        return [
            ["Target Credits", dataset.data.Completed],
            ["Actual Credits Achieved", dataset.data.Pending]
        ];
    }

    function getSubtitle() {
        return `<span style="font-size: 80px">${completionPercentage}%</span><br><span style="font-size: 22px">${dataset.status}</span>`;
    }

    function update() {
        chart.update({
            subtitle: {
                text: getSubtitle()
            }
        });

        chart.series[0].update({
            name: 'Completed',
            data: getData()
        });
    }

    return {
        init: function(data) {
            dataset = JSON.parse(data);
            completionPercentage = dataset.completion_percentage;

            chart = Highcharts.chart('container', {
                title: {
                    text: '',
                    align: 'center'
                },
                subtitle: {
                    useHTML: true,
                    text: getSubtitle(),
                    floating: true,
                    verticalAlign: 'middle',
                    y: 30
                },
                legend: {
                    enabled: true,
                    itemHoverStyle: {
                        color: '#FF0000'
                    },
                    align: 'center',
                    verticalAlign: 'bottom',
                    layout: 'horizontal',
                    symbolRadius: 155,
                    itemStyle: {
                        fontSize: '16px',
                        fontWeight: 'normal'
                    }
                },
                tooltip: {
                    valueDecimals: 2,
                },
                plotOptions: {
                    pie: {
                        borderWidth: 0,
                        colorByPoint: true,
                        size: '100%',
                        innerSize: '70%',
                        dataLabels: {
                            enabled: false,
                            crop: false,
                            distance: '-20%',
                            style: {
                                fontWeight: 'bold',
                                fontSize: '16px'
                            },
                            connectorWidth: 0
                        },
                        center: ['50%', '50%']
                    }
                },
                colors: ['#0f6cbf','#eeaf00'],
                series: [{
                    type: 'pie',
                    name: dataset.status,
                    data: getData(),
                    showInLegend: true  // Display legend items for each data point
                }],
                credits: {
                    enabled: false
                }
            });


        }
    };
});