{"version":3,"file":"form-options-selector.min.js","sources":["../src/form-options-selector.js"],"sourcesContent":["/*\n* This file is a part of e abyas Info Solutions.\n*\n* Copyright e abyas Info Solutions Pvt Ltd, India.\n*\n* This program is free software; you can redistribute it and/or modify\n* it under the terms of the GNU General Public License as published by\n* the Free Software Foundation; either version 3 of the License, or\n* (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU General Public License for more details.\n*\n* You should have received a copy of the GNU General Public License\n* along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*\n* @author e abyas  <info@eabyas.com>\n*/\n/**\n * Defines form autocomplete (types of form element)\n *\n * @package    local_kpichallenge\n * @copyright  e abyas  <info@eabyas.com>\n */\n\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/str'], function($, Ajax, Templates, Str) {\n\n    /** @var {Number} Maximum number of options to show. */\n    var MAXOPTIONS = 100;\n\n    return /** @alias module:enrol_manual/form-potential-option-selector */ {\n\n        processResults: function(selector, results) {\n            var options = [];\n            if ($.isArray(results)) {\n                $.each(results, function(index, option) {\n                    options.push({\n                        value: option.id,\n                        label: option._label\n                    });\n                });\n                return options;\n\n            } else {\n                return results;\n            }\n        },\n\n        transport: function(selector, query, success, failure) {\n            var promise;\n            contextid = parseInt($(selector).data('contextid'), 10);\n            action = $(selector).data('action');\n            formoptions = $(selector).data('options');\n            var defaultstrings = Str.get_strings([\n                {\n                    key:'selectdept',\n                    component: 'local_courses',\n                },\n                {\n                    key:'selectsubdept',\n                    component: 'local_courses',\n                },\n                {\n                    key:'selectcat',\n                    component: 'local_courses',\n                }\n            ]);\n            defaultstrings.then(function(s){\n                var departmentselect = '<span><span>'+s[0]+'</span></span>';\n                var subdeptartmentselect = '<span><span>'+s[1]+'</span></span>';\n                var categoryselect = '<span><span>'+s[2]+'</span></span>';\n\n                if (action === 'costcenter_organisation_selector') {\n                    $(\"#id_open_costcenterid\").on('change', function() {\n                        var department = $('#id_open_departmentid').val();\n                        if(parseInt(department) > 0){\n                            $('#id_open_departmentid').html('');\n                            $('.departmentselect .form-autocomplete-selection .form-autocomplete-selection').html(departmentselect);\n                        }\n                        var subdept = $('#id_open_subdepartment').val();\n\n                        if(parseInt(subdept) > 0){\n                            $('#id_open_subdepartment').html('');\n                            $('.subdepartmentselect .form-autocomplete-selection').html(subdeptartmentselect);\n                        }\n                        var category = $('#id_category').val();\n                        if(parseInt(category) > 0){\n                            $('#id_category').html('');\n                            $('.categoryselect .form-autocomplete-selection').html(categoryselect);\n                        }\n                    });\n                }else if(action === 'costcenter_department_selector' || action === 'costcenter_subdepartment_selector'){\n                    $('#id_open_departmentid').on('change', function(){\n                        var subdept = $('#id_open_subdepartment').val();\n                        if(parseInt(subdept) > 0){\n                            $('#id_open_subdepartment').html('');\n                            $('.subdepartmentselect .form-autocomplete-selection').html(subdeptartmentselect);\n                        }\n                        var category = $('#id_category').val();\n                        if(parseInt(category) > 0){\n                            $('#id_category').html('');\n                            $('.categoryselect .form-autocomplete-selection').html(categoryselect);\n                        } \n                    });\n                    $('#id_open_subdepartment').on('change', function(){\n                        var category = $('#id_category').val();\n                        if(parseInt(category) > 0){\n                            $('#id_category').html('');\n                            $('.categoryselect .form-autocomplete-selection').html(categoryselect);\n                        }\n                    });\n                }\n            });\n            if(action === 'costcenter_department_selector' || action === 'costcenter_subdepartment_selector'){\n                formoptions.parentid = $('[data-class=\"' + $(selector).data('parentclass') + '\"]').val();\n            }else if(action === 'costcenter_category_selector'){\n                formoptions.organisationid = $(\"#id_open_costcenterid\").val();\n                formoptions.departmentid = $(\"#id_open_departmentid\").val();\n                formoptions.subdepartment = $(\"#id_open_subdepartment\").val();\n            }\n            formoptions = JSON.stringify(formoptions);\n\n            promise = Ajax.call([{\n                methodname: 'local_costcenter_form_option_selector',\n                args: {\n                    query: query,\n                    context: {contextid: contextid},\n                    action: action,\n                    options: formoptions,\n                    searchanywhere: true,\n                    page: 0,\n                    perpage: MAXOPTIONS + 1\n                }\n            }]);\n\n            promise[0].then(function(results) {\n                results = $.parseJSON(results);\n                var promises = [],\n                    i = 0;\n                var contexttemplate;\n                // if (action === 'kpichallenge_kpi_selector') {\n                //     contexttemplate = 'local_kpichallenge/form-option-kpiselector-suggestion';\n                // }else if (action === 'kpichallenge_challengee_selector' || action === 'challenge_challengee_selector' || action === 'challenge_challenger_selector') {\n                    contexttemplate = 'local_costcenter/form-option-selector-suggestion';\n                // } else {\n                //     contexttemplate = 'local_kpichallenge/form-option-selector-suggestion';\n                // }    \n                if (results.length <= MAXOPTIONS) {\n                    // Render the label.\n                    $.each(results, function(index, option) {\n                        var ctx = option,\n                            identity = [];\n                            ctx.hasidentity = true;\n                        ctx.identity = identity.join(', ');\n                        promises.push(Templates.render(contexttemplate, ctx));\n                    });\n\n                    // Apply the label to the results.\n                    return $.when.apply($.when, promises).then(function() {\n                        var args = arguments;\n                        $.each(results, function(index, option) {\n                            option._label = args[i];\n                            i++;\n                        });\n                        success(results);\n                        return;\n                    });\n\n                } else {\n                    return Str.get_string('toomanyoptionstoshow', 'local_costcenter', '>' + MAXOPTIONS).then(function(toomanyoptionstoshow) {\n                        success(toomanyoptionstoshow);\n                        return;\n                    });\n                }\n\n            }).fail(failure);\n        }\n\n    };\n\n});\n"],"names":["define","$","Ajax","Templates","Str","processResults","selector","results","options","isArray","each","index","option","push","value","id","label","_label","transport","query","success","failure","contextid","parseInt","data","action","formoptions","get_strings","key","component","then","s","departmentselect","subdeptartmentselect","categoryselect","on","department","val","html","subdept","category","parentid","organisationid","departmentid","subdepartment","JSON","stringify","call","methodname","args","context","searchanywhere","page","perpage","MAXOPTIONS","parseJSON","promises","i","length","ctx","hasidentity","identity","join","render","when","apply","arguments","get_string","toomanyoptionstoshow","fail"],"mappings":"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"}