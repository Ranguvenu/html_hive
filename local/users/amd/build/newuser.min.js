define ("local_users/newuser",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","local_courses/jquery.dataTables"],function(a,b,c,d,e,f,g){var h=function(a){this.contextid=a.context;this.id=a.id;var b=this;this.args=a;b.init(a)};h.prototype.modal=null;h.prototype.contextid=-1;h.prototype.init=function(){var e=this;if(e.id){var f=b.get_string("edituser","local_users")}else{var f=b.get_string("adnewuser","local_users")}return f.then(function(a){return c.create({type:c.types.DEFAULT,title:a,body:this.getBody(),footer:this.getFooter()})}.bind(this)).then(function(b){this.modal=b;this.modal.setLarge();this.modal.getRoot().addClass("openLMStransition local_users");this.modal.getRoot().on(d.hidden,function(){this.modal.getRoot().animate({right:"-85%"},500);setTimeout(function(){b.destroy()},500)}.bind(this));this.modal.getFooter().find("[data-action=\"save\"]").on("click",this.submitForm.bind(this));this.modal.getFooter().find("[data-action=\"cancel\"]").on("click",function(){b.hide();setTimeout(function(){b.destroy()},500);window.location.reload()});this.modal.getFooter().find("[data-action=\"skip\"]").on("click",function(){e.args.form_status=e.args.form_status+1;var c=e.getBody();c.then(function(a){if(!1===a){window.location.reload()}});b.setBody(c);if(2==e.args.form_status){a("[data-action=\"skip\"]").css("display","none")}});this.modal.getFooter().find("[data-action=\"previous\"]").on("click",function(){e.args.form_status=e.args.form_status-1;var c=e.getBody();c.then(function(a){if(!1===a){window.location.reload()}});b.setBody(c);if(0==e.args.form_status){a("[data-action=\"skip\"]").css("display","none");a("[data-action=\"previous\"]").css("display","none")}});this.modal.getRoot().on("submit","form",function(a){e.submitFormAjax(a,e.args)});this.modal.show();this.modal.getRoot().animate({right:"0%"},500);return this.modal}.bind(this))};h.prototype.getBody=function(a){if("undefined"==typeof a){a={}}this.args.jsonformdata=JSON.stringify(a);return e.loadFragment("local_users","new_create_user",this.contextid,this.args)};h.prototype.getFooter=function(){$footer="<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">Save & Continue</button>&nbsp;";$style="style=\"display:none;\"";$footer+="<button type=\"button\" class=\"btn btn-secondary\" data-action=\"previous\" "+$style+" >Previous</button>&nbsp;";$footer+="<button type=\"button\" class=\"btn btn-secondary\" data-action=\"skip\" "+$style+" >Skip</button>&nbsp;";$footer+="<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">Cancel</button>";return $footer};h.prototype.handleFormSubmissionResponse=function(){this.modal.hide();g.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()});var b={id:args.id},d=c.create({type:c.types.DEFAULT,body:Templates.render("local_classroom/classroomview",b)});a.when(d).then(function(){}).fail(Notification.exception)};h.prototype.handleFormSubmissionFailure=function(a){this.modal.setBody(this.getBody(a))};h.prototype.submitFormAjax=function(b,c){b.preventDefault();var d=this,e=this.modal.getRoot().find("form").serialize(),g={};g.contextid=this.contextid;g.jsonformdata=JSON.stringify(e);g.form_status=c.form_status;var h=f.call([{methodname:"local_users_submit_create_user_form",args:g}]);h[0].done(function(b){if(-1!==b.form_status&&!1!==b.form_status){d.args.form_status=b.form_status;d.args.id=b.id;d.handleFormSubmissionFailure()}else{d.modal.hide();window.location.reload()}if(0<c.form_status){a("[data-action=\"skip\"]").css("display","inline-block");a("[data-action=\"previous\"]").css("display","inline-block")}if(2==c.form_status){a("[data-action=\"skip\"]").css("display","none")}}).fail(function(){d.handleFormSubmissionFailure(e)})};h.prototype.submitForm=function(a){a.preventDefault();var b=this;b.modal.getRoot().find("form").submit()};return{init:function init(a){return new h(a)},load:function load(){a(document).on("change","#id_open_costcenterid",function(){var b=a(this).find("option:selected").val();if(null!==b){var c=f.call([{methodname:"local_users_get_departments_list",args:{costcenterid:b,contextid:1}}]);c[0].done(function(b){var b=JSON.parse(b),c="";a.each(b,function(a,b){c+="<option value = "+a+" >"+b+"</option>"});a("#id_open_departmentid").html(c)})}a("#id_open_departmentid").trigger("change");a("#id_open_subdepartment").trigger("change")});a(document).on("change","#id_open_departmentid",function(){var b=a(this).find("option:selected").val();if(null!==b){var c=f.call([{methodname:"local_users_get_subdepartments_list",args:{departmentid:b,contextid:1}}]);c[0].done(function(b){var b=JSON.parse(b),c="";a.each(b,function(a,b){c+="<option value = "+a+" >"+b+"</option>"});a("#id_open_subdepartment").html(c)})}});a(document).on("change","#id_open_costcenterid",function(){var b=a(this).find("option:selected").val();if(0!=b){var c=f.call([{methodname:"local_users_get_supervisors_list",args:{costcenterid:b,contextid:1}}]);c[0].done(function(b){var b=JSON.parse(b),c="";a.each(b,function(a,b){c+="<option value = "+a+" >"+b+"</option>"});a("#open_supervisorid").html(c)})}a("#open_supervisorid").trigger("change")});a(document).on("change","#id_open_costcenterid",function(){var b=a(this).find("option:selected").val();if(0!=b){var c=f.call([{methodname:"local_users_get_domains_list",args:{costcenterid:b,contextid:1}}]);c[0].done(function(b){var b=JSON.parse(b),c="";a.each(b,function(a,b){c+="<option value = "+a+" >"+b+"</option>"});console.log(c);a("#id_open_domainid").html(c)})}a("#id_open_domainid").trigger("change")});a(document).on("change","#id_open_domainid",function(){var b=a("#id_open_costcenterid").val();if(0<b){b=b}else{b=a("input[name=open_costcenterid]").val()}var c=a(this).find("option:selected").val();if(0!=b&&0!=c){var d={costcenterid:b,domain:c,contextid:1},e=f.call([{methodname:"local_users_get_positions_list",args:d}]);e[0].done(function(b){var b=JSON.parse(b),c="";a.each(b,function(a,b){c+="<option value = "+a+" >"+b+"</option>"});a("#id_open_positionid").html(c)})}a("#id_open_positionid").trigger("change")})},deleteConfirm:function deleteConfirm(a){return b.get_strings([{key:"confirm"},{key:"deleteconfirm",component:"local_users",param:a},{key:"deleteallconfirm",component:"local_users"},{key:"delete"}]).then(function(b){c.create({title:b[0],type:c.types.SAVE_CANCEL,body:b[1]}).done(function(c){this.modal=c;c.setSaveButtonText(b[3]);c.getRoot().on(d.save,function(b){b.preventDefault();a.confirm=!0;var c={id:a.id,contextid:a.contextid},d=f.call([{methodname:"local_users_"+a.action,args:c}]);d[0].done(function(){window.location.href=window.location.href}).fail(function(a){console.log(a)})}.bind(this));c.show()}.bind(this))}.bind(this))},userSuspend:function userSuspend(a){return b.get_strings([{key:"confirm"},{key:"suspendconfirm"+a.status,component:"local_users",param:a},{key:"suspendallconfirm",component:"local_users"},{key:"confirm"}]).then(function(b){c.create({title:b[0],type:c.types.SAVE_CANCEL,body:b[1]}).done(function(c){this.modal=c;c.setSaveButtonText(b[3]);c.getRoot().on(d.save,function(b){b.preventDefault();a.confirm=!0;var c={id:a.id,contextid:a.contextid},d=f.call([{methodname:"local_users_suspend_user",args:c}]);d[0].done(function(){window.location.href=window.location.href}).fail(function(a){console.log(a)})}.bind(this));c.show()}.bind(this))}.bind(this))},skillslist:function skillslist(f){element=".competencynames";if(!a(element).hasClass("clicked")){a(element).addClass("clicked");var g={categoryid:f.categoryid,costcenterid:f.costcenterid,positionid:f.positionid,userid:f.userid},h=e.loadFragment("local_skillrepository","competency_skills_display",f.contextid,g);c.create({title:b.get_string("categorypopup","local_users",f.categoryname),body:h}).done(function(b){b.show();b.setLarge();b.getRoot().on(d.hidden,function(){b.setBody("")}.bind(this));b.getRoot().find("[data-action=\"hide\"]").on("click",function(){a(element).removeClass("clicked");b.hide();setTimeout(function(){b.destroy()},500)})})}}}});
//# sourceMappingURL=newuser.min.js.map
