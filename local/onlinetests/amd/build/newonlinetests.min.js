define(["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","local_onlinetests/jquery.dataTables"],function(a,b,c,d,e,f,g){var h=function(a,b,c){this.contextid=b,this.testid=c;var d=this;d.init(a)};return h.prototype.modal=null,h.prototype.contextid=-1,h.prototype.init=function(e){var f=this;a(document).on("click",e,function(){var e=a(this).data("value");return e?(f.testid=e,update_string=b.get_string("editonlinetests","local_onlinetests")):(f.testid=-1,update_string=b.get_string("createonlinetest","local_onlinetests")),update_string.then(function(a){return c.create({type:c.types.SAVE_CANCEL,title:a,body:f.getBody()})}.bind(f)).then(function(a){return f.modal=a,f.modal.show(),f.modal.setLarge(),f.modal.getRoot().addClass("openLMStransition local_onlinetests"),f.modal.getRoot().animate({right:"0%"},500),f.modal.getRoot().on(d.hidden,function(){f.modal.getRoot().animate({right:"-85%"},500),setTimeout(function(){a.destroy()},1e3),f.modal.setBody("")}.bind(this)),f.modal.getRoot().on(d.shown,function(){f.modal.getRoot().append("<style>[data-fieldtype=submit] { display: none ! important; }</style>")}.bind(this)),f.modal.getRoot().on(d.save,f.submitForm.bind(f)),f.modal.getRoot().on("submit","form",f.submitFormAjax.bind(f)),this.modal}.bind(this))})},h.prototype.getBody=function(a){"undefined"==typeof a&&(a={});var b={testid:this.testid,jsonformdata:JSON.stringify(a)};return e.loadFragment("local_onlinetests","new_onlinetest_form",this.contextid,b)},h.prototype.handleFormSubmissionResponse=function(a){this.modal.hide(),g.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()});var d={id:a,sesskey:M.cfg.sesskey},f=e.loadFragment("local_onlinetests","addquestions_or_enrol",this.contextid,d);c.create({title:b.get_string("pluginname","local_onlinetests"),body:f}).done(function(a){a.show(),a.getRoot().find('[data-action="hide"]').on("click",function(){a.hide(),setTimeout(function(){window.location.reload()},500)})})},h.prototype.handleFormSubmissionFailure=function(a){this.modal.setBody(this.getBody(a))},h.prototype.submitFormAjax=function(a){a.preventDefault();var b=this.modal.getRoot().find("form").serialize(),c=f.call([{methodname:"local_onlinetests_submit_create_onlinetest_form",args:{contextid:this.contextid,jsonformdata:JSON.stringify(b)},fail:this.handleFormSubmissionFailure.bind(this,b)}]),d=this;c[0].done(function(a){d.handleFormSubmissionResponse(a)})},h.prototype.submitForm=function(a){a.preventDefault();var b=this;b.modal.getRoot().find("form").submit()},{init:function(a,b,c){return new h(a,b,c)},getdepartmentlist:function(){},enrolledusers:function(b){var f=a(".onlinetest_users_count").hasClass("clicked");if(a(".onlinetest_users_count").addClass("clicked"),!f){var g={testid:b.testid,type:b.type},h=e.loadFragment("local_onlinetests","enrolled_users",b.contextid,g);c.create({title:b.testname,body:h}).done(function(b){b.show(),b.setLarge(),b.getRoot().on(d.hidden,function(){b.setBody("")}.bind(this)),b.getRoot().find('[data-action="hide"]').on("click",function(){b.hide(),a(".onlinetest_users_count").removeClass("clicked"),setTimeout(function(){b.destroy()},500)})})}},deleteonlinetest:function(a){return b.get_strings([{key:"deleteonlinetest",component:"local_onlinetests"},{key:"confirmdelete",component:"local_onlinetests"}]).then(function(b){c.create({title:b[0],type:c.types.DEFAULT,body:b[1],footer:'<button type="button" class="btn btn-primary" data-action="save">'+M.util.get_string("yes","moodle")+'</button>&nbsp;<button type="button" class="btn btn-secondary" data-action="cancel">'+M.util.get_string("no","moodle")+"</button>"}).done(function(b){this.modal=b,b.getRoot().find('[data-action="save"]').on("click",function(){window.location.href="index.php?delete="+a+"&confirm=1&sesskey="+M.cfg.sesskey}.bind(this)),b.getFooter().find('[data-action="cancel"]').on("click",function(){b.setBody(""),b.hide()}),b.show()}.bind(this))}.bind(this))},suspendonlinetest:function(a,d,e){return console.log,b.get_strings([{key:"suspendconfirm",component:"local_onlinetests",param:e},{key:"inactiveconfirm",component:"local_onlinetests",param:e},{key:"activeconfirm",component:"local_onlinetests",param:e}]).then(function(b){"enable"==a.status?b[1]=b[1]:"disable"==a.status&&(b[1]=b[2]),c.create({title:b[0],type:c.types.DEFAULT,body:b[1],footer:'<button type="button" class="btn btn-primary" data-action="save">'+M.util.get_string("yes","local_onlinetests")+'</button>&nbsp;<button type="button" class="btn btn-secondary" data-action="cancel">'+M.util.get_string("no","local_onlinetests")+"</button>"}).done(function(b){this.modal=b,b.getRoot().find('[data-action="save"]').on("click",function(){window.location.href=M.cfg.wwwroot+"/local/onlinetests/index.php?id="+a.id+"&visible="+a.visible+"&hide=1&sesskey="+M.cfg.sesskey}.bind(this)),b.getFooter().find('[data-action="cancel"]').on("click",function(){b.setBody(""),b.hide()}),b.show()}.bind(this))}.bind(this))}}});