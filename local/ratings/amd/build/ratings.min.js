define ("local_ratings/ratings",["core/ajax","core/str","core/templates","jquery","jqueryui"],function(a,b,c,d){var e=function(a,b){var c=this;if("undefined"==typeof b){b={}}b.max="undefined"==typeof b.max?5:b.max;b.rgbOn="undefined"==typeof b.rgbOn?"#f1c40f":b.rgbOn;b.spaceWidth="undefined"==typeof b.spaceWidth?"1px":b.spaceWidth;b.fontsize="undefined"==typeof b.fontsize?"25px":b.fontsize;b.rgbOff="undefined"==typeof b.rgbOff?"#ecf0f1":b.rgbOff;b.rgbSelection="undefined"==typeof b.rgbSelection?"#ffcf10":b.rgbSelection;b.cursor="undefined"==typeof b.cursor?"pointer":b.cursor;b.indicator="undefined"==typeof b.indicator?"fa fa-star":"fa "+b.indicator;var e="undefined"==typeof d(a).data("stars")?0:d(a).data("stars");d(a).css("cursor",b.cursor);d(a).append(d("<input>",{type:"hidden",name:a.replace("#",""),value:e}));d(a).append(d("<i>",{class:b.indicator,style:"display:none; font-size: "+b.fontsize+"; color: transparent;"}));for(var f=1,g;f<=b.max;f++){g=d("<i>",{class:b.indicator,style:"font-size: "+b.fontsize+"; margin-left: "+b.spaceWidth+"; color:"+(f<=e?b.rgbOn:b.rgbOff)});d(a).append(g)}c.set_target_width(a,b);d(a).append(d("<i>",{class:b.indicator,style:"display:none; font-size: "+b.fontsize+"; color: transparent;"}));d.each(d(a+" > i"),function(f,g){d(g).click(function(){d("[name="+a.replace("#","")+"]").val(f);for(var g=1;g<=b.max;g++){d(d(a+"> i")[g]).css("color",g<=f?b.rgbOn:b.rgbOff)}if(!("undefined"===b.rate)){e=f;c.set_user_ratings(a,f)}});d(g).mouseover(function(){for(var c=1;c<=b.max;c++){d(d(a+" > i")[c]).css("color",c<=f?b.rgbSelection:b.rgbOff)}});d(g).mouseleave(function(){d("[name="+a.replace("#","")+"]").val(f);for(var c=1;c<=b.max;c++){d(d(a+"> i")[c]).css("color",c<=e?b.rgbOn:b.rgbOff)}})})};e.prototype.set_target_width=function(a,b){var c=b.indicator.replace(/\ /g,"."),e=b.spaceWidth,f=d("."+c).width();d(a).width((f+e)*(b.max+1)+"px")};e.prototype.set_user_ratings=function(a,b){var c=d(a).data();d.ajax({url:M.cfg.wwwroot+"/local/ratings/update.php",method:"POST",data:{itemid:c.itemid,ratearea:c.ratearea,rating:b},success:function success(a){d(".overall_ratings_"+c.itemid).html(" "+a+" ");d(".rating_tooltip").html("")}})};return{init:function init(a,b){b=JSON.parse(b);return new e(a,b)},updatevalues:function updatevalues(a){var b=a.action;d.ajax({url:M.cfg.wwwroot+"/local/ratings/index.php?likearea="+a.likearea+"&item="+a.itemid+"&action="+a.action,beforeSend:function beforeSend(){d("#loading_image").show()},success:function success(c){if(b){d(".fa-thumbs-down").css("color","#0769ad");d(".fa-thumbs-up").css("color","#6d6f71")}else{d(".fa-thumbs-up").css("color","#0769ad");d(".fa-thumbs-down").css("color","#6d6f71")}d(".count_unlikearea_"+a.itemid).html(c.dislike);d(".count_likearea_"+a.itemid).html(c.like);d("#loading_image").hide()}})},trigger:function trigger(){d(document).ready(function(){var b=d("#ratingList").html();if(""==b){d("#ratingList").html(" ");var e=d("#ratingList"),f=d("#ratingList").data(),g={};g.itemid=f.itemid;g.ratearea=f.ratearea;g.contextid=1;var h=a.call([{methodname:"local_ratings_get_ratings_info",args:g}]);h[0].done(function(a){c.render("local_ratings/detailed_info_loaded",a).then(function(a){e.html(a)})})}});d(".overall_users.mt-10").hover(function(){var b=d(this).find(".rating_tooltip").html();if(""==b){d(this).find(".rating_tooltip").html(" ");var e=d(this).find(".rating_tooltip"),f=d(this).find(".rating_tooltip").data(),g={};g.itemid=f.itemid;g.ratearea=f.ratearea;g.contextid=1;var h=a.call([{methodname:"local_ratings_get_ratings_info",args:g}]);h[0].done(function(a){c.render("local_ratings/detailed_info",a).then(function(a){e.html(a)})})}})},comment_item:function comment_item(c){b.get_strings([{key:"postcomment",component:"local_ratings"}]).then(function(b){var e=c.userid,f=c.itemid,g=c.commentarea,h=d("#post_comment_"+g+"_"+f).data("comment"),i="form_comment_item"+e+"_"+f+g,j=d("#post_comment_"+g+"_"+f).parents("div");if(1>d("#ratings_comment_"+g+"_"+f).length){d("#post_comment_"+g+"_"+f).append("<div id=\"ratings_comment_"+g+"_"+f+"\" class=\"postcomment\"><div class=\"commentloading\"></div><form id=\""+i+"\" ><textarea id=\"text_"+i+"\" type=\"text\" name=\"comment\">"+h+"</textarea><input type=\"submit\" value=\"Submit\"></form></div>")}var k=d("#ratings_comment_"+g+"_"+f).dialog({resizable:!0,autoOpen:!1,width:"20%",title:b[0],modal:!1,dialogClass:"commentdialog",show:{effect:"slide",duration:1e3},position:{my:"left",at:"right",of:"#post_comment_"+g+"_"+f,within:j},open:function open(){d(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var a=d(".ui-icon-closethick").parent();d(a).attr({title:"Close"});d(".sendmessage").not(this).each(function(){d(this).remove()})},close:function close(){d(this).dialog("destroy").remove()}});k.dialog("open");d("#"+i).submit(function(b){b.preventDefault();var c=document.getElementById("text_"+i).value;if(!c){d(".commentloading").html("<div class=\"alert alert-danger\">You must supply a value here</div>")}else{url=require("core/url");d(".commentloading").html("<center><img src=\""+url.imageUrl("loader","local_ratings")+"\" alt=\"Saving Comment\" title=\"Saving Comment\"/></center>");d("#"+i).hide();var h=a.call([{methodname:"local_ratings_save_comment",args:{userid:e,itemid:f,commentarea:g,comment:c}}]);h[0].done(function(){k.dialog("close");d("#post_comment_"+g+"_"+f).data("comment",c);content=c.slice(0,50);d("#comment_value_"+g+"_"+f).html(content);d("#comment_value_"+g+"_"+f).prop("title",c)}).fail(function(a){console.log(a)})}})})},load:function load(){}}});
//# sourceMappingURL=ratings.min.js.map
