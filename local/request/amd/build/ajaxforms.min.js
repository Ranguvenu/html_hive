define ("local_request/ajaxforms",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","core/templates","local_classroom/classroom"],function(a,b,c,d,e,f,g,h,i){classroomlastchildpopup=function classroomlastchildpopup(e){a.ajax({type:"POST",url:M.cfg.wwwroot+"/local/classroom/ajax.php",data:{classroomid:e.id,action:"classroomlastchildpopup",sesskey:M.cfg.sesskey},success:function success(e){c.create({title:b.get_string("classroom_info","local_classroom"),body:e}).done(function(b){b.show();b.setLarge();b.getRoot().addClass("openLMStransition");b.getRoot().animate({right:"0%"},500);b.getRoot().on(d.hidden,function(){b.getRoot().animate({right:"-85%"},500);setTimeout(function(){b.destroy()},1e3)}.bind(this));a(".close").click(function(){window.location.href=window.location.href})})}})};var j=function(a){this.contextid=a.contextid;this.args=a;this.init(a)};j.prototype.modal=null;j.prototype.contextid=-1;j.prototype.init=function(e){var f=this;console.log(e);switch(e.callback){case"request_form":switch(e.id){case 0:header_label="requestcourse";break;default:header_label="updaterequest";}break;}return b.get_string(header_label,"local_request").then(function(a){return c.create({type:c.types.DEFAULT,title:a,body:this.getBody(),footer:this.getFooter()})}.bind(this)).then(function(b){this.modal=b;this.modal.setLarge();this.modal.getRoot().addClass("openLMStransition local_classroom");this.modal.getRoot().on(d.hidden,function(){this.modal.getRoot().animate({right:"-85%"},500);setTimeout(function(){b.destroy()},1e3)}.bind(this));this.modal.getFooter().find("[data-action=\"save\"]").on("click",this.submitForm.bind(this));this.modal.getFooter().find("[data-action=\"cancel\"]").on("click",function(){window.location.href=window.location.href});this.modal.getFooter().find("[data-action=\"skip\"]").on("click",function(){f.args.form_status=f.args.form_status+1;if(3==e.form_status){classroomlastchildpopup(e)}var c=f.getBody();c.then(function(b){if(!1===b){f.handleFormSubmissionResponse(e);a("#viewclassrooms").dataTable().destroy();i.Datatable()}});b.setBody(c)});this.modal.getRoot().on("submit","form",function(a){f.submitFormAjax(a,f.args)});this.modal.show();this.modal.getRoot().animate({right:"0%"},500);a(".close").click(function(){window.location.href=window.location.href});return this.modal}.bind(this))};j.prototype.getBody=function(a){if("undefined"==typeof a){a={}}this.args.jsonformdata=JSON.stringify(a);return e.loadFragment(this.args.component,this.args.callback,this.contextid,this.args)};j.prototype.getFooter=function(){$footer="<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">Save & Continue</button>&nbsp;";if(0==this.args.form_status){$style="style=\"display:none;\"";$footer+="<button type=\"button\" class=\"btn btn-secondary\" data-action=\"skip\" "+$style+">Skip</button>&nbsp;"}$footer+="<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">Cancel</button>";return $footer};j.prototype.handleFormSubmissionResponse=function(a){this.modal.hide();g.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()});if(-2==a.form_status){window.location.reload()}classroomlastchildpopup(a)};j.prototype.handleFormSubmissionFailure=function(a){this.modal.setBody(this.getBody(a))};j.prototype.submitFormAjax=function(b,c){b.preventDefault();var d=this,e=this.modal.getRoot().find("form").serialize(),g=c.plugintype+"_"+c.pluginname+"_submit_instance",h={};h.contextid=this.contextid;h.jsonformdata=JSON.stringify(e);h.form_status=c.form_status;var i=f.call([{methodname:g,args:h}]);i[0].done(function(b){d.args.form_status=b.form_status;if(0<=b.form_status&&!1!==b.form_status){d.args.form_status=b.form_status;d.args.id=b.id;d.handleFormSubmissionFailure()}else{d.handleFormSubmissionResponse(d.args)}if(0<c.form_status){a("[data-action=\"skip\"]").css("display","inline-block")}}).fail(function(){d.handleFormSubmissionFailure(e)})};j.prototype.submitForm=function(a){a.preventDefault();this.modal.getRoot().find("form").submit()};return{init:function init(a){return new j(a)},load:function load(){}}});
//# sourceMappingURL=ajaxforms.min.js.map
