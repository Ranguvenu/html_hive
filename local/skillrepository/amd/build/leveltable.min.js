define ("local_skillrepository/leveltable",["local_skillrepository/jquery.dataTables","core/str","core/modal_factory","core/modal_events","core/ajax","core/fragment","jquery","jqueryui"],function(a,b,c,d,f,g,h){var e=function(a){this.args=a;var b=this;b.init(a)};e.prototype.modal=null;e.prototype.contextid=-1;e.prototype.init=function(a){var e=this;if(a.levelid){var f=b.get_string("update_level","local_skillrepository")}else{var f=b.get_string("create_level","local_skillrepository")}return f.then(function(a){return c.create({type:c.types.SAVE_CANCEL,title:a,body:e.getBody()})}.bind(e)).then(function(a){e.modal=a;e.modal.setLarge();this.modal.getRoot().addClass("openLMStransition local_skillrepository");this.modal.getRoot().on(d.hidden,function(){this.modal.getRoot().animate({right:"-85%"},500);setTimeout(function(){a.destroy()},5e3)}.bind(this));e.modal.getRoot().on(d.shown,function(){e.modal.getRoot().append("<style>[data-fieldtype=submit] { display: none ! important; }</style>");this.modal.getFooter().find("[data-action=\"cancel\"]").on("click",function(){a.hide();setTimeout(function(){a.destroy()},5e3)})}.bind(this));e.modal.getRoot().on(d.save,e.submitForm.bind(e));e.modal.getRoot().on("submit","form",e.submitFormAjax.bind(e));e.modal.show();this.modal.getRoot().animate({right:"0%"},500);return this.modal}.bind(this))};e.prototype.getBody=function(a){if("undefined"==typeof a){a={}}var b={levelid:this.args.levelid,jsonformdata:JSON.stringify(a)};return g.loadFragment("local_skillrepository","level_form",this.args.contextid,b)};e.prototype.handleFormSubmissionResponse=function(){this.modal.hide();Y.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()});document.location.reload()};e.prototype.handleFormSubmissionFailure=function(a){this.modal.setBody(this.getBody(a))};e.prototype.submitFormAjax=function(a){a.preventDefault();var b=this.modal.getRoot().find("form").serialize();f.call([{methodname:"local_skillrepository_submit_level_form",args:{contextid:this.args.contextid,jsonformdata:b},done:this.handleFormSubmissionResponse.bind(this,b),fail:this.handleFormSubmissionFailure.bind(this,b)}])};e.prototype.submitForm=function(a){a.preventDefault();var b=this;b.modal.getRoot().find("form").submit()};return{init:function init(a){return new e(a)},leveltable:function leveltable(){h("#all_levels_display_table").dataTable({processing:!0,bServerSide:!0,sAjaxSource:M.cfg.wwwroot+"/local/skillrepository/ajax.php?action=getlevelstable",aaSorting:[],pageLength:10});h("#all_levels_display_table").css("width","100%")},deletelevel:function deletelevel(a){return b.get_strings([{key:"confirm"},{key:"deletelevelconfirm",component:"local_skillrepository",param:a},{key:"delete"}]).then(function(e){c.create({title:e[0],type:c.types.SAVE_CANCEL,body:e[1]}).done(function(c){this.modal=c;c.setSaveButtonText(b.get_string("yes_delete","local_skillrepository"));var e=b.get_string("cancel","local_skillrepository"),f=this.modal.getFooter().find("[data-action=\"cancel\"]");this.modal.asyncSet(e,f.text.bind(f));c.getRoot().on(d.save,function(b){b.preventDefault();a.confirm=!0;h.ajax({method:"POST",dataType:"json",url:M.cfg.wwwroot+"/local/skillrepository/ajax.php?action=deletelevel&levelid="+a.levelid,success:function success(){window.location.reload()}})}.bind(this));c.show()}.bind(this))}.bind(this))}}});
//# sourceMappingURL=leveltable.min.js.map
