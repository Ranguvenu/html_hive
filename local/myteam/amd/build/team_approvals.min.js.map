{"version":3,"sources":["../src/team_approvals.js"],"names":["define","Str","ModalFactory","ModalEvents","Ajax","Templates","$","init","requestsearch","params","learningtype","changed_learningtype","val","search","searchvalue","action","promise","call","methodname","args","done","resp","data","render","response","then","html","fail","ex","console","log","select_learningtype","pluginname","select_request","requestid","coursecheckedstatus","element","checked","allocate","prop","approve_request","learning_type","requeststoapprove","each","requestid_selected","push","length","create","title","get_string","type","types","DEFAULT","body","modal","setSaveButtonText","value","button","getFooter","find","asyncSet","text","bind","show","getRoot","on","hidden","destroy","cancel","SAVE_CANCEL","save","JSON","stringify","hide","window","location","href","setTimeout"],"mappings":"AASAA,OAAM,+BAAC,CACH,UADG,CAEH,oBAFG,CAGH,mBAHG,CAIH,WAJG,CAKH,gBALG,CAMH,QANG,CAAD,CAOH,SAASC,CAAT,CAAcC,CAAd,CAA4BC,CAA5B,CAAyCC,CAAzC,CAA+CC,CAA/C,CAA0DC,CAA1D,CAA6D,CAE5D,MAAO,CACHC,IAAI,CAAE,eAAW,CAEhB,CAHE,CAIHC,aAAa,CAAE,uBAASC,CAAT,CAAiB,IACxBC,CAAAA,CAAY,CAAGD,CAAM,CAACC,YADE,CAGxBC,CAAoB,CAAGL,CAAC,CAAC,wCAAD,CAAD,CAA0CM,GAA1C,EAHC,CAI5B,GAAGD,CAAH,CAAwB,CACpBD,CAAY,CAAGC,CAClB,CACD,GAAIE,CAAAA,CAAM,CAAGJ,CAAM,CAACK,WAApB,CACA,GAAqB,WAAlB,QAAOD,CAAAA,CAAP,EAA2C,IAAV,EAAAA,CAApC,CAAmD,CAC/C,QACH,CAV2B,GAcpBJ,CAAAA,CAAM,CAAG,EAdW,CAexBA,CAAM,CAACM,MAAP,CAAgB,YAAhB,CACAN,CAAM,CAACC,YAAP,CAAsBA,CAAtB,CACAD,CAAM,CAACI,MAAP,CAAgBA,CAAhB,CAEA,GAAIG,CAAAA,CAAO,CAAGZ,CAAI,CAACa,IAAL,CAAU,CAAC,CACrBC,UAAU,CAAE,iCADS,CAErBC,IAAI,CAAEV,CAFe,CAAD,CAAV,CAAd,CAIAO,CAAO,CAAC,CAAD,CAAP,CAAWI,IAAX,CAAgB,SAASC,CAAT,CAAe,CAC3B,GAAIC,CAAAA,CAAI,CAAGjB,CAAS,CAACkB,MAAV,CAAiB,4BAAjB,CAA+C,CAACC,QAAQ,CAAEH,CAAX,CAA/C,CAAX,CACAC,CAAI,CAACG,IAAL,CAAU,SAASD,CAAT,CAAkB,CACvBlB,CAAC,uBAAD,CAAUoB,IAAV,CAAeF,CAAf,CACJ,CAFD,CAGH,CALD,EAKGG,IALH,CAKQ,SAASC,CAAT,CAAa,CAEjBC,OAAO,CAACC,GAAR,CAAYF,CAAZ,CACH,CARD,CASP,CApCE,CAqCHG,mBAAmB,CAAE,6BAAStB,CAAT,CAAiB,IAC9BC,CAAAA,CAAY,CAAGD,CAAM,CAACC,YADQ,CAE9BsB,CAAU,CAAGvB,CAAM,CAACuB,UAFU,CAIlC1B,CAAC,CAAC,wCAAD,CAAD,CAA0CM,GAA1C,CAA8CF,CAA9C,EACAJ,CAAC,CAAC,iCAAD,CAAD,CAAmCM,GAAnC,CAAuC,EAAvC,EACAN,CAAC,CAAC,6BAAD,CAAD,CAAiCoB,IAAjC,CAAsCM,CAAtC,EANkC,GAQ9BvB,CAAAA,CAAM,CAAG,EARqB,CASlCA,CAAM,CAACM,MAAP,CAAgB,qBAAhB,CACAN,CAAM,CAACC,YAAP,CAAsBA,CAAtB,CACAD,CAAM,CAACI,MAAP,IAEA,GAAIG,CAAAA,CAAO,CAAGZ,CAAI,CAACa,IAAL,CAAU,CAAC,CACrBC,UAAU,CAAE,iCADS,CAErBC,IAAI,CAAEV,CAFe,CAAD,CAAV,CAAd,CAIAO,CAAO,CAAC,CAAD,CAAP,CAAWI,IAAX,CAAgB,SAASC,CAAT,CAAe,CAC3B,GAAIC,CAAAA,CAAI,CAAGjB,CAAS,CAACkB,MAAV,CAAiB,4BAAjB,CAA+C,CAACC,QAAQ,CAAEH,CAAX,CAA/C,CAAX,CACAC,CAAI,CAACG,IAAL,CAAU,SAASD,CAAT,CAAkB,CACvBlB,CAAC,uBAAD,CAAUoB,IAAV,CAAeF,CAAf,CACJ,CAFD,CAGH,CALD,EAKGG,IALH,CAKQ,SAASC,CAAT,CAAa,CAEjBC,OAAO,CAACC,GAAR,CAAYF,CAAZ,CACH,CARD,CASH,CA/DE,CAgEHK,cAAc,CAAE,wBAASxB,CAAT,CAAiB,IACzBC,CAAAA,CAAY,CAAGD,CAAM,CAACC,YADG,CAEzBwB,CAAS,CAAGzB,CAAM,CAACyB,SAFM,CAGzBC,CAAmB,CAAG1B,CAAM,CAAC2B,OAAP,CAAeC,OAHZ,CAIzBC,CAAQ,GAJiB,CAM7B,GAAe,CAAZ,CAAAJ,CAAH,CAAiB,CACb,GAAG,IAAAC,CAAH,CAA+B,CAC3BG,CAAQ,GACX,CACJ,CAED,GAAG,IAAAA,CAAH,CAAoB,CAChBhC,CAAC,CAAC,uBAAD,CAAD,CAA2BiC,IAA3B,CAAiC,UAAjC,IACH,CAFD,IAEK,CACDjC,CAAC,CAAC,uBAAD,CAAD,CAA2BiC,IAA3B,CAAiC,UAAjC,IACH,CAEJ,CAlFE,CAoFHC,eAAe,CAAE,0BAAW,IACpBC,CAAAA,CAAa,CAAGnC,CAAC,CAAC,yBAAD,CAAD,CAA6BM,GAA7B,EADI,CAEpB8B,CAAiB,CAAG,EAFA,CAIxBpC,CAAC,CAAC,sCAAD,CAAD,CAAwCM,GAAxC,CAA4C,EAA5C,EACAN,CAAC,CAAC,yCAAD,CAAD,CAA2CqC,IAA3C,CAAgD,UAAY,CACxD,GAAIC,CAAAA,CAAkB,CAAGtC,CAAC,CAAC,IAAD,CAAD,CAAQM,GAAR,EAAzB,CACA8B,CAAiB,CAACG,IAAlB,CAAuBD,CAAvB,CACH,CAHD,EAKCf,OAAO,CAACC,GAAR,CAAYY,CAAZ,EACD,GAAG,CAACD,CAAa,CAACK,MAAlB,CAAyB,CACrB5C,CAAY,CAAC6C,MAAb,CAAoB,CAChBC,KAAK,CAAE/C,CAAG,CAACgD,UAAJ,CAAe,SAAf,CADS,CAEhBC,IAAI,CAAEhD,CAAY,CAACiD,KAAb,CAAmBC,OAFT,CAGhBC,IAAI,CAAEpD,CAAG,CAACgD,UAAJ,CAAe,qBAAf,CAAsC,cAAtC,CAHU,CAApB,EAIG7B,IAJH,CAIQ,SAASkC,CAAT,CAAgB,CACpBA,CAAK,CAACC,iBAAN,CAAwBtD,CAAG,CAACgD,UAAJ,CAAe,SAAf,CAA0B,cAA1B,CAAxB,EADoB,GAIhBO,CAAAA,CAAK,CAACvD,CAAG,CAACgD,UAAJ,CAAe,QAAf,CAAyB,cAAzB,CAJU,CAKhBQ,CAAM,CAAGH,CAAK,CAACI,SAAN,GAAkBC,IAAlB,CAAuB,0BAAvB,CALO,CAMpBL,CAAK,CAACM,QAAN,CAAeJ,CAAf,CAAsBC,CAAM,CAACI,IAAP,CAAYC,IAAZ,CAAiBL,CAAjB,CAAtB,EAEAH,CAAK,CAACS,IAAN,GACAT,CAAK,CAACU,OAAN,GAAgBC,EAAhB,CAAmB9D,CAAW,CAAC+D,MAA/B,CAAuC,UAAW,CAC9CZ,CAAK,CAACa,OAAN,EACH,CAFD,EAGAb,CAAK,CAACU,OAAN,GAAgBC,EAAhB,CAAmB9D,CAAW,CAACiE,MAA/B,CAAuC,UAAW,CAC9Cd,CAAK,CAACa,OAAN,EACH,CAFD,CAGH,CAnBD,EAoBA,QACH,CAED,GAAG,CAACzB,CAAiB,CAACI,MAAtB,CAA6B,CACzB5C,CAAY,CAAC6C,MAAb,CAAoB,CAChBC,KAAK,CAAE/C,CAAG,CAACgD,UAAJ,CAAe,SAAf,CADS,CAEhBC,IAAI,CAAEhD,CAAY,CAACiD,KAAb,CAAmBC,OAFT,CAGhBC,IAAI,CAAEpD,CAAG,CAACgD,UAAJ,CAAe,iBAAf,CAAkC,cAAlC,CAHU,CAApB,EAIG7B,IAJH,CAIQ,SAASkC,CAAT,CAAgB,CACpBA,CAAK,CAACC,iBAAN,CAAwBtD,CAAG,CAACgD,UAAJ,CAAe,SAAf,CAA0B,cAA1B,CAAxB,EADoB,GAIhBO,CAAAA,CAAK,CAACvD,CAAG,CAACgD,UAAJ,CAAe,QAAf,CAAyB,cAAzB,CAJU,CAKhBQ,CAAM,CAAGH,CAAK,CAACI,SAAN,GAAkBC,IAAlB,CAAuB,0BAAvB,CALO,CAMpBL,CAAK,CAACM,QAAN,CAAeJ,CAAf,CAAsBC,CAAM,CAACI,IAAP,CAAYC,IAAZ,CAAiBL,CAAjB,CAAtB,EAEAH,CAAK,CAACS,IAAN,GACAT,CAAK,CAACU,OAAN,GAAgBC,EAAhB,CAAmB9D,CAAW,CAAC+D,MAA/B,CAAuC,UAAW,CAC9CZ,CAAK,CAACa,OAAN,EACH,CAFD,EAGAb,CAAK,CAACU,OAAN,GAAgBC,EAAhB,CAAmB9D,CAAW,CAACiE,MAA/B,CAAuC,UAAW,CAC9Cd,CAAK,CAACa,OAAN,EACH,CAFD,CAGH,CAnBD,EAoBA,QACH,CAEDjE,CAAY,CAAC6C,MAAb,CAAoB,CAChBC,KAAK,CAAE/C,CAAG,CAACgD,UAAJ,CAAe,SAAf,CADS,CAEhBC,IAAI,CAAEhD,CAAY,CAACiD,KAAb,CAAmBkB,WAFT,CAGhBhB,IAAI,CAAEpD,CAAG,CAACgD,UAAJ,CAAe,sBAAf,CAAuC,cAAvC,CAHU,CAApB,EAIG7B,IAJH,CAIQ,SAASkC,CAAT,CAAgB,CACpBA,CAAK,CAACC,iBAAN,CAAwBtD,CAAG,CAACgD,UAAJ,CAAe,SAAf,CAA0B,cAA1B,CAAxB,EADoB,GAIZO,CAAAA,CAAK,CAACvD,CAAG,CAACgD,UAAJ,CAAe,QAAf,CAAyB,cAAzB,CAJM,CAKZQ,CAAM,CAAGH,CAAK,CAACI,SAAN,GAAkBC,IAAlB,CAAuB,0BAAvB,CALG,CAMhBL,CAAK,CAACM,QAAN,CAAeJ,CAAf,CAAsBC,CAAM,CAACI,IAAP,CAAYC,IAAZ,CAAiBL,CAAjB,CAAtB,EACJH,CAAK,CAACS,IAAN,GACAT,CAAK,CAACU,OAAN,GAAgBC,EAAhB,CAAmB9D,CAAW,CAAC+D,MAA/B,CAAuC,UAAW,CAC9CZ,CAAK,CAACa,OAAN,EACH,CAFD,EAIAb,CAAK,CAACU,OAAN,GAAgBC,EAAhB,CAAmB9D,CAAW,CAACmE,IAA/B,CAAqC,UAAW,IACxC7D,CAAAA,CAAM,CAAG,CACNM,MADM,CACG,iBADH,CAEN2B,iBAFM,CAEc6B,IAAI,CAACC,SAAL,CAAe9B,CAAf,CAFd,CAGNhC,YAHM,CAGS+B,CAHT,CAD+B,CAMxCzB,CAAO,CAAGZ,CAAI,CAACa,IAAL,CAAU,CAAC,CACrBC,UAAU,CAAE,oCADS,CAErBC,IAAI,CAAEV,CAFe,CAAD,CAAV,CAN8B,CAU5CO,CAAO,CAAC,CAAD,CAAP,CAAWI,IAAX,CAAgB,UAAe,CAC3Bd,CAAC,CAAC,2BAAD,CAAD,CAA+BoB,IAA/B,CAAoC,8KAApC,EAEA4B,CAAK,CAACmB,IAAN,GACAnB,CAAK,CAACa,OAAN,GACAO,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuBF,MAAM,CAACC,QAAP,CAAgBC,IAE1C,CAPD,EAOGjD,IAPH,CAOQ,SAASC,CAAT,CAAa,CAEjBC,OAAO,CAACC,GAAR,CAAYF,CAAZ,CACH,CAVD,CAWH,CArBD,EAsBA0B,CAAK,CAACU,OAAN,GAAgBC,EAAhB,CAAmB9D,CAAW,CAACiE,MAA/B,CAAuC,UAAW,CAC9CS,UAAU,CAAC,UAAU,CACjBvB,CAAK,CAACa,OAAN,EACH,CAFS,CAEP,GAFO,CAGb,CAJD,CAQH,CA9CD,CA+CH,CA9LE,CAgMV,CAzMK,CAAN","sourcesContent":["/**\n * Add a create new group modal to the page.\n *\n * @module     core_group/AjaxForms\n * @class      AjaxForms\n * @package    core_group\n * @copyright  2017 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'core/str',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/ajax',\n    'core/templates',\n    'jquery',\n], function(Str, ModalFactory, ModalEvents, Ajax, Templates, $) {\n    var team_approvals;\n    return {\n        init: function() {\n\n        },\n        requestsearch: function(params) {\n            var learningtype = params.learningtype;\n\n            var changed_learningtype = $('input[name=\"approval_learning_type\"]').val();\n            if(changed_learningtype){\n                learningtype = changed_learningtype;\n            }\n            var search = params.searchvalue;\n            if(typeof(search) == 'undefined' || search == null){\n                return false;\n            }\n            //if(learningtype == 'elearning'){\n                var target = '#team_requests_list';\n        \n                var params = {};\n                params.action = 'searchdata';\n                params.learningtype = learningtype;\n                params.search = search;\n\n                var promise = Ajax.call([{\n                    methodname: 'local_myteam_teamapprovals_view',\n                    args: params\n                }]);\n                promise[0].done(function(resp) {\n                    var data = Templates.render('local_myteam/requestsearch', {response: resp});\n                    data.then(function(response){\n                         $(target).html(response);\n                    });\n                }).fail(function(ex) {\n                    // do something with the exception\n                    console.log(ex);\n                });\n        },\n        select_learningtype: function(params) {\n            var learningtype = params.learningtype;\n            var pluginname = params.pluginname;\n\n            $('input[name=\"approval_learning_type\"]').val(learningtype);\n            $('input[name=\"search_requests\"]').val('');\n            $('.team_learningtype_dropdown').html(pluginname);\n            var target = '#team_requests_list';\n            var params = {};\n            params.action = 'change_learningtype';\n            params.learningtype = learningtype;\n            params.search = false;\n\n            var promise = Ajax.call([{\n                methodname: 'local_myteam_teamapprovals_view',\n                args: params\n            }]);\n            promise[0].done(function(resp) {\n                var data = Templates.render('local_myteam/requestsearch', {response: resp});\n                data.then(function(response){\n                     $(target).html(response);\n                });\n            }).fail(function(ex) {\n                // do something with the exception\n                console.log(ex);\n            });\n        },\n        select_request: function(params) {\n            var learningtype = params.learningtype;\n            var requestid = params.requestid;\n            var coursecheckedstatus = params.element.checked;\n            var allocate = false;\n\n            if(requestid > 0){\n                if(coursecheckedstatus == true){\n                    allocate = true;\n                }\n            }\n\n            if(allocate == true){\n                $('.request_approval_btn').prop( \"disabled\", false);\n            }else{\n                $('.request_approval_btn').prop( \"disabled\", true);\n            }\n\n        },\n\n        approve_request: function() {\n            var learning_type = $('#approval_learning_type').val();\n            var requeststoapprove = [];\n\n            $('input[name=\"search_learningtypes\"]').val('');\n            $('input[name=\"team_requests[]\"]:checked').each(function () {\n                var requestid_selected = $(this).val();\n                requeststoapprove.push(requestid_selected);\n            });\n\n             console.log(requeststoapprove);\n            if(!learning_type.length){\n                ModalFactory.create({\n                    title: Str.get_string('warning'),\n                    type: ModalFactory.types.DEFAULT,\n                    body: Str.get_string('select_learningtype', 'local_myteam')\n                }).done(function(modal) {\n                    modal.setSaveButtonText(Str.get_string('approve', 'local_myteam'));\n\n                    //For cancel button string changed//\n                    var value=Str.get_string('reject', 'local_myteam');\n                    var button = modal.getFooter().find('[data-action=\"cancel\"]');\n                    modal.asyncSet(value, button.text.bind(button));\n\n                    modal.show();\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    modal.getRoot().on(ModalEvents.cancel, function() {\n                        modal.destroy();\n                    });\n                });\n                return false;\n            }\n\n            if(!requeststoapprove.length){\n                ModalFactory.create({\n                    title: Str.get_string('warning'),\n                    type: ModalFactory.types.DEFAULT,\n                    body: Str.get_string('select_requests', 'local_myteam')\n                }).done(function(modal) {\n                    modal.setSaveButtonText(Str.get_string('approve', 'local_myteam'));\n\n                    //For cancel button string changed//\n                    var value=Str.get_string('reject', 'local_myteam');\n                    var button = modal.getFooter().find('[data-action=\"cancel\"]');\n                    modal.asyncSet(value, button.text.bind(button));\n\n                    modal.show();\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    modal.getRoot().on(ModalEvents.cancel, function() {\n                        modal.destroy();\n                    });\n                });\n                return false;\n            }\n\n            ModalFactory.create({\n                title: Str.get_string('confirm'),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: Str.get_string('team_request_confirm', 'local_myteam')\n            }).done(function(modal) {\n                modal.setSaveButtonText(Str.get_string('approve', 'local_myteam'));\n\n                //For cancel button string changed//\n                    var value=Str.get_string('reject', 'local_myteam');\n                    var button = modal.getFooter().find('[data-action=\"cancel\"]');\n                    modal.asyncSet(value, button.text.bind(button));\n                modal.show();\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n\n                modal.getRoot().on(ModalEvents.save, function() {\n                    var params = {};\n                    params.action = 'requestapproved';\n                    params.requeststoapprove = JSON.stringify(requeststoapprove);\n                    params.learningtype = learning_type;\n\n                    var promise = Ajax.call([{\n                        methodname: 'local_myteam_teamapprovals_actions',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        $('#allocation_notifications').html('<div class=\"alert alert-info\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\">×</button>Selected learning types has been allocated.</div>');\n                        \n                        modal.hide();\n                        modal.destroy();\n                        window.location.href = window.location.href;\n\n                    }).fail(function(ex) {\n                        // do something with the exception\n                        console.log(ex);\n                    });\n                });\n                modal.getRoot().on(ModalEvents.cancel, function() {\n                    setTimeout(function(){\n                        modal.destroy();\n                    }, 1000);\n                });\n\n\n                 //return modal;\n            });\n        }\n    };\n});\n"],"file":"team_approvals.min.js"}