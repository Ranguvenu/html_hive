/**
 * Add a create new group modal to the page.
 *
 * @module     local_learningplan/lpunenrol
 * @class      lpunenrol
 * @package    local_learningplan
 * @copyright  eabyas
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_learningplan/lpunenrol",["local_courses/jquery.dataTables","jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","jqueryui"],(function(DataTable,$,Str,ModalFactory,ModalEvents,Fragment,Ajax,Y){var lpunenrol=function(args){this.pathid=args.pathid,this.userid=args.userid,this.init(args)};return lpunenrol.prototype.modal=null,lpunenrol.prototype.contextid=-1,lpunenrol.prototype.init=function(args){var self=this;return Str.get_string("confirm").then(function(title){return ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:title,body:self.getBody()})}.bind(self)).then(function(modal){return self.modal=modal,this.modal.getRoot().on(ModalEvents.hidden,function(){setTimeout((function(){modal.destroy()}),1e3)}.bind(this)),self.modal.getRoot().on(ModalEvents.shown,function(){this.modal.getFooter().find('[data-action="save"]').on("click",(function(){var reason=$(".reason").val();if(""!=reason.trim()){var params={};params.lpathid=args.pathid,params.contextid=1,params.userid=args.userid,params.reason=reason,Ajax.call([{methodname:"local_learningplan_lpath_unenrol_reason",args:params}])[0].done((function(resp){window.location.href=M.cfg.wwwroot+"/"})).fail((function(ex){window.location.href=M.cfg.wwwroot+"/local/learningplan/view.php?id="+args.pathid,console.log(ex)}))}else""==reason.trim()&&$(".unenrolerror").attr("style","display:block;color:red")})),this.modal.getFooter().find('[data-action="cancel"]').on("click",(function(){modal.hide(),setTimeout((function(){modal.destroy()}),1e3)}))}.bind(this)),self.modal.getRoot().on(ModalEvents.save,self.submitForm.bind(self)),self.modal.getRoot().on("submit","form",self.submitFormAjax.bind(self)),self.modal.show(),this.modal.getRoot().animate({right:"10%"},800),this.modal}.bind(this))},lpunenrol.prototype.getBody=function(formdata){var params={pathid:this.pathid,userid:this.userid};return Fragment.loadFragment("local_learningplan","learningplan_unenrol",1,params)},lpunenrol.prototype.handleFormSubmissionResponse=function(){this.modal.hide(),Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),document.location.reload()},lpunenrol.prototype.handleFormSubmissionFailure=function(data){this.modal.setBody(this.getBody(data))},lpunenrol.prototype.submitFormAjax=function(e){e.preventDefault()},lpunenrol.prototype.submitForm=function(e){e.preventDefault();this.modal.getRoot().find("form").submit()},{init:function(args){return new lpunenrol(args)},Datatable:function(args){Str.get_strings([{key:"search"}]).then(function(str){$("#unenrol_lpaths").dataTable({searching:!0,responsive:!0,aaSorting:[[1,"desc"]],lengthMenu:[[10,15,25,50,100,-1],[10,15,25,50,100,"All"]],aoColumnDefs:[{bSortable:!1,aTargets:[1]}],language:{search:"_INPUT_",searchPlaceholder:str[0],paginate:{next:">",previous:"<"}}})}.bind(this))},load:function(){}}}));

//# sourceMappingURL=lpunenrol.min.js.map
