define ("local_learningplan/lpcreate",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui"],function(a,b,c,d,e,f){var g=function(a){this.contextid=a.contextid;this.planid=a.planid;this.args=a;var b=this;b.init(a)};g.prototype.modal=null;g.prototype.contextid=-1;g.prototype.init=function(){var e=this;if(e.planid){console.log(e.planid);var f=b.get_string("editlearningplan","local_learningplan")}else{var f=b.get_string("adnewlearningplan","local_learningplan")}return f.then(function(a){return c.create({type:c.types.SAVE_CANCEL,title:a,body:e.getBody()})}.bind(e)).then(function(b){e.modal=b;e.modal.getRoot().addClass("openLMStransition");e.modal.setLarge();e.modal.getRoot().on(d.hidden,function(){e.modal.setBody(e.getBody());e.modal.getRoot().animate({right:"-85%"},500);setTimeout(function(){b.destroy()},1e3)}.bind(this));this.modal.getFooter().find("[data-action=\"cancel\"]").on("click",function(){window.location.href=window.location.href});e.modal.getRoot().on(d.shown,function(){e.modal.getRoot().append("<style>[data-fieldtype=submit] { display: none ! important; }</style>")}.bind(this));e.modal.getRoot().on(d.save,e.submitForm.bind(e));e.modal.getRoot().on("submit","form",function(a){e.submitFormAjax(a,e.args)});this.modal.show();this.modal.getRoot().animate({right:"0%"},500);a(".close").click(function(){window.location.href=window.location.href});return this.modal}.bind(this))};g.prototype.getBody=function(a){if("undefined"==typeof a){a={}}this.args.jsonformdata=JSON.stringify(a);return e.loadFragment("local_learningplan","new_learningplan",this.contextid,this.args)};g.prototype.handleFormSubmissionFailure=function(a){this.modal.setBody(this.getBody(a))};g.prototype.submitFormAjax=function(a,b){a.preventDefault();var c=this,d=this.modal.getRoot().find("form").serialize(),e={};e.id=this.planid;e.contextid=this.contextid;e.jsonformdata=JSON.stringify(d);e.form_status=b.form_status;var g=f.call([{methodname:"local_learningplan_submit_learningplan_form",args:e}]);g[0].done(function(a){if(-1!==a.form_status&&!1!==a.form_status){c.args.form_status=a.form_status;c.args.id=a.id;c.handleFormSubmissionFailure()}else{c.modal.hide();window.location.reload()}}).fail(function(){c.handleFormSubmissionFailure(d)})};g.prototype.submitForm=function(a){a.preventDefault();var b=this;b.modal.getRoot().find("form").submit()};return{init:function init(a){return new g(a)},load:function load(){},deleteConfirm:function deleteConfirm(a){return b.get_strings([{key:"confirm"},{key:"deleteconfirm",component:"local_learningplan",param:a},{key:"deleteallconfirm",component:"local_learningplan"},{key:"delete"}]).then(function(b){c.create({title:b[0],type:c.types.SAVE_CANCEL,body:b[1]}).done(function(c){this.modal=c;c.setSaveButtonText(b[3]);c.getRoot().on(d.save,function(b){b.preventDefault();a.confirm=!0;var c=f.call([{methodname:"local_learningplan_"+a.action,args:a}]);c[0].done(function(){window.location.href=window.location.href}).fail(function(a){console.log(a)})}.bind(this));c.show()}.bind(this));modal.show()}.bind(this))},toggleVisible:function toggleVisible(a){return b.get_strings([{key:"confirm"+a.visible,component:"local_learningplan"},{key:"activeconfirm"+a.visible,component:"local_learningplan",param:a},{key:"Confirm"}]).then(function(b){c.create({title:b[0],type:c.types.SAVE_CANCEL,body:b[1]}).done(function(c){this.modal=c;c.setSaveButtonText(b[2]);c.getRoot().on(d.save,function(b){b.preventDefault();a.confirm=!0;var c=f.call([{methodname:"local_learningplan_"+a.action,args:a}]);c[0].done(function(){window.location.href=window.location.href}).fail(function(a){console.log(a)})}.bind(this));c.show()}.bind(this))}.bind(this))},unassignCourses:function unassignCourses(a){return b.get_strings([{key:"confirm"},{key:"unassign_courses_confirm",component:"local_learningplan",param:a},{key:"unassign",component:"local_learningplan"}]).then(function(b){c.create({title:b[0],type:c.types.SAVE_CANCEL,body:b[1]}).done(function(c){this.modal=c;c.setSaveButtonText(b[2]);c.getRoot().on(d.save,function(b){b.preventDefault();params={};params.courseid=a.unassigncourseid;params.planid=a.planid;var c=f.call([{methodname:"local_learningplan_"+a.action,args:params}]);c[0].done(function(){window.location.href=window.location.href}).fail(function(a){console.log(a)})}.bind(this));c.show()}.bind(this));modal.show()}.bind(this))},unassignUsers:function unassignUsers(a){return b.get_strings([{key:"confirm"},{key:"unassign_users_confirm",component:"local_learningplan",param:a},{key:"unassign",component:"local_learningplan"}]).then(function(b){c.create({title:b[0],type:c.types.SAVE_CANCEL,body:b[1]}).done(function(c){this.modal=c;c.setSaveButtonText(b[2]);c.getRoot().on(d.save,function(b){b.preventDefault();params={};params.userid=a.unassignuserid;params.planid=a.planid;var c=f.call([{methodname:"local_learningplan_"+a.action,args:params}]);c[0].done(function(){window.location.href=window.location.href}).fail(function(a){console.log(a)})}.bind(this));c.show()}.bind(this));modal.show()}.bind(this))}}});
//# sourceMappingURL=lpcreate.min.js.map
