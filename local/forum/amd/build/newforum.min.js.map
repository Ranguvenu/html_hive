{"version":3,"sources":["../src/newforum.js"],"names":["define","DataTable","$","Str","ModalFactory","ModalEvents","Fragment","Ajax","Y","NewForum","args","contextid","context","id","self","init","prototype","modal","head","get_string","then","title","create","type","types","DEFAULT","body","getBody","footer","getFooter","bind","setLarge","getRoot","addClass","on","hidden","animate","setTimeout","destroy","find","submitForm","hide","form_status","window","location","reload","form","submitFormAjax","show","formdata","jsonformdata","JSON","stringify","loadFragment","$footer","M","util","$style","handleFormSubmissionResponse","use","core_formchangechecker","reset_form_dirty_state","document","handleFormSubmissionFailure","data","setBody","e","preventDefault","formData","serialize","params","promise","call","methodname","done","resp","css","fail","submit","costcentervalue","val","ajax","method","dataType","url","cfg","wwwroot","success","depttemplate","each","index","value","html","grptitle","template","departmentvalue","load","deleteforum","elem","get_strings","key","component","s","href","sesskey","load_datatable","tableid","order"],"mappings":"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","sourcesContent":["/**\r\n * Add a create new group modal to the page.\r\n *\r\n * @module     local_forum/newforum\r\n * @class      newforum\r\n * @package    local_forum\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(['local_courses/jquery.dataTables', 'jquery', 'core/str', 'core/modal_factory', 'core/modal_events', 'core/fragment', 'core/ajax', 'core/yui'],\r\n        function(DataTable, $, Str, ModalFactory, ModalEvents, Fragment, Ajax, Y) {\r\n \r\n    /**\r\n     * Constructor\r\n     *\r\n     * @param {String} selector used to find triggers for the new group modal.\r\n     * @param {int} contextid\r\n     *\r\n     * Each call to init gets it's own instance of this class.\r\n     */\r\n    var NewForum = function(args) {\r\n\r\n        this.contextid = args.context;\r\n        this.id = args.id;\r\n        var self = this;\r\n        this.args = args;\r\n        self.init(args);\r\n    };\r\n \r\n    /**\r\n     * @var {Modal} modal\r\n     * @private\r\n     */\r\n    NewForum.prototype.modal = null;\r\n \r\n    /**\r\n     * @var {int} contextid\r\n     * @private\r\n     */\r\n    NewForum.prototype.contextid = -1;\r\n \r\n    /**\r\n     * Initialise the class.\r\n     *\r\n     * @param {String} selector used to find triggers for the new group modal.\r\n     * @private\r\n     * @return {Promise}\r\n     */\r\n    NewForum.prototype.init = function(args) {\r\n        //var triggers = $(selector);\r\n        var self = this;\r\n        // Fetch the title string.\r\n            if (self.id) {\r\n                head =  Str.get_string('editforum', 'local_forum');\r\n            }else{\r\n               head =  Str.get_string('forum:addinstance', 'local_forum');\r\n            }\r\n            return head.then(function(title) {\r\n                // Create the modal.\r\n                return ModalFactory.create({\r\n                type: ModalFactory.types.DEFAULT,\r\n                title: title,\r\n                body: this.getBody(),\r\n                footer: this.getFooter(),\r\n                });\r\n            }.bind(this)).then(function(modal) {\r\n                // Keep a reference to the modal.\r\n                this.modal = modal;\r\n                // self.modal.show();\r\n                // Forms are big, we want a big modal.\r\n                this.modal.setLarge(); \r\n                \r\n                this.modal.getRoot().addClass('openLMStransition');\r\n\r\n                // this.modal.getRoot().on(ModalEvents.hidden, function() {\r\n                //     this.modal.setBody('');\r\n                this.modal.getRoot().on(ModalEvents.hidden, function() {\r\n                    this.modal.getRoot().animate({\"right\":\"-85%\"}, 500);\r\n                    setTimeout(function(){\r\n                        modal.destroy();\r\n                    }, 1000);\r\n                }.bind(this));\r\n\r\n                this.modal.getFooter().find('[data-action=\"save\"]').on('click', this.submitForm.bind(this));\r\n                // We also catch the form submit event and use it to submit the form with ajax.\r\n\r\n                // this.modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\r\n                //     modal.setBody('');\r\n                //     modal.hide();\r\n                this.modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\r\n                    modal.hide();\r\n                    setTimeout(function(){\r\n                        modal.destroy();\r\n                    }, 1000);\r\n                     //modal.destroy();\r\n                    if (args.form_status !== 0 ) {\r\n                        window.location.reload();\r\n                    }\r\n                });\r\n                this.modal.getRoot().find('[data-action=\"hide\"]').on('click', function() {\r\n                    modal.hide();\r\n                    setTimeout(function(){\r\n                        modal.destroy();\r\n                    }, 1000);\r\n                     //modal.destroy();\r\n                    if (args.form_status !== 0 ) {\r\n                        window.location.reload();\r\n                    }\r\n                });\r\n\r\n                this.modal.getRoot().on('submit', 'form', function(form) {\r\n                    self.submitFormAjax(form, self.args);\r\n                });\r\n                this.modal.show();\r\n                this.modal.getRoot().animate({\"right\":\"0%\"}, 500);\r\n\r\n                return this.modal;\r\n            }.bind(this));       \r\n        \r\n        \r\n        // });\r\n        \r\n    };\r\n \r\n    /**\r\n     * @method getBody\r\n     * @private\r\n     * @return {Promise}\r\n     */\r\n    NewForum.prototype.getBody = function(formdata) {\r\n        if (typeof formdata === \"undefined\") {\r\n            formdata = {};\r\n        }\r\n        // Get the content of the modal.\r\n        this.args.jsonformdata = JSON.stringify(formdata);\r\n        return Fragment.loadFragment('local_forum', 'new_forum_form', this.contextid, this.args);\r\n    };\r\n    /**\r\n     * @method getFooter\r\n     * @private\r\n     * @return {Promise}\r\n     */\r\n    NewForum.prototype.getFooter = function() {\r\n        $footer = '<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">'+M.util.get_string(\"save_continue\", \"local_forum\")+'</button>&nbsp;';\r\n        $style = 'style=\"display:none;\"';\r\n        //$footer += '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"skip\" ' + $style + ' >Skip</button>&nbsp;';\r\n        $footer += '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">'+M.util.get_string(\"cancel\", \"moodle\")+'</button>';\r\n        return $footer;\r\n    };\r\n \r\n    /**\r\n     * @method handleFormSubmissionResponse\r\n     * @private\r\n     * @return {Promise}\r\n     */\r\n    NewForum.prototype.handleFormSubmissionResponse = function(args) {\r\n        this.modal.hide();\r\n        // We could trigger an event instead.\r\n        Y.use('moodle-core-formchangechecker', function() {\r\n            M.core_formchangechecker.reset_form_dirty_state();\r\n        });\r\n        document.location.reload();\r\n        //var modalPromise = ModalFactory.create({\r\n        //    type: ModalFactory.types.DEFAULT,\r\n        //    body: this.getBody(),\r\n        //});\r\n        //$.when(modalPromise).then(function(modal) {\r\n        //\r\n        //    modal.show();\r\n        //    return modal;\r\n        //}).fail(Notification.exception);\r\n    };\r\n \r\n    /**\r\n     * @method handleFormSubmissionFailure\r\n     * @private\r\n     * @return {Promise}\r\n     */\r\n    NewForum.prototype.handleFormSubmissionFailure = function(data) {\r\n         // We need to re-display the form with errors!\r\n        this.modal.setBody(this.getBody(data));\r\n    };\r\n \r\n    /**\r\n     * Private method\r\n     *\r\n     * @method submitFormAjax\r\n     * @private\r\n     * @param {Event} e Form submission event.\r\n     */\r\n    NewForum.prototype.submitFormAjax = function(e ,args) {\r\n        // We don't want to do a real form submission.\r\n        e.preventDefault();\r\n        var self = this;\r\n        // Convert all the form elements values to a serialised string.\r\n        var formData = this.modal.getRoot().find('form').serialize();\r\n        var methodname = 'local_forum_submit_create_forum_form';\r\n        var params = {};\r\n        params.contextid = this.contextid;\r\n        params.form_status = args.form_status;\r\n        params.jsonformdata = JSON.stringify(formData);\r\n        \r\n\r\n        var promise = Ajax.call([{\r\n            methodname: methodname,\r\n            args: params\r\n        }]);\r\n         promise[0].done(function(resp){\r\n            // alert(resp.form_status);\r\n            if(resp.form_status !== -1 && resp.form_status !== false) {\r\n                self.args.form_status = resp.form_status;\r\n                self.args.id = resp.id;\r\n                self.handleFormSubmissionFailure();\r\n                if (resp.form_status == 2) {\r\n                    //code\r\n                     self.handleFormSubmissionResponse(self.args);\r\n                }\r\n            } else {\r\n                self.handleFormSubmissionResponse(self.args);\r\n            }\r\n            if(args.form_status > 0) {\r\n                $('[data-action=\"skip\"]').css('display', 'inline-block');\r\n            }\r\n        }).fail(function(ex){\r\n            self.handleFormSubmissionFailure(formData);\r\n        });\r\n\r\n    };\r\n \r\n    /**\r\n     * This triggers a form submission, so that any mform elements can do final tricks before the form submission is processed.\r\n     *\r\n     * @method submitForm\r\n     * @param {Event} e Form submission event.\r\n     * @private\r\n     */\r\n    NewForum.prototype.submitForm = function(e) {\r\n        e.preventDefault();\r\n        var self = this;\r\n        self.modal.getRoot().find('form').submit();\r\n    };\r\n \r\n    return {\r\n        // Public variables and functions.\r\n        /**\r\n         * Attach event listeners to initialise this module.\r\n         * @method init\r\n         * @param {args} \r\n         */\r\n        init: function(args) {\r\n            $(document).on('change', '#id_costcenterid', function() {\r\n                \r\n                var costcentervalue = $(this).find(\"option:selected\").val();\r\n                title = M.util.get_string(\"all\", \"moodle\");\r\n                if (costcentervalue !== null) {\r\n                    $.ajax({\r\n                        method: \"GET\",\r\n                        dataType: \"json\",\r\n                        url: M.cfg.wwwroot + \"/local/forum/dept_ajax.php?action=departmentlist&costcenter=\"+costcentervalue,\r\n                        success: function(data){\r\n                            var depttemplate = '<option value=\"\">'+title+'</option>';\r\n                              $.each( data.data, function( index, value) {\r\n                                   depttemplate +=\t'<option value = ' + index + ' >' +value + '</option>';\r\n                                });\r\n                            $(\"#id_departmentid\").html(depttemplate);\r\n                        }\r\n                    });\r\n                    grptitle = M.util.get_string(\"all\", \"moodle\");\r\n                    $.ajax({\r\n                        method: \"GET\",\r\n                        dataType: \"json\",\r\n                        url: M.cfg.wwwroot + \"/local/forum/dept_ajax.php?action=groupslist&costcenter=\"+costcentervalue,\r\n                        success: function(data){\r\n                            var template = '<option value=\"\">'+grptitle+'</option>';\r\n                              $.each( data.data, function( index, value) {\r\n                                   template +=\t'<option value = ' + index + ' >' +value+ '</option>';\r\n                              });\r\n                            $(\"#id_local_group\").html(template);\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n            \r\n            $(document).on('change', '#id_departmentid', function() {\r\n                //var departmentvalue = $(this).find(\"option:selected\").val();\r\n                var departmentvalue = $('#id_departmentid').val();\r\n                title = M.util.get_string(\"all\", \"moodle\");\r\n                //if (departmentvalue !== null && !isNaN(parseInt(departmentvalue, 10))) {\r\n                if (departmentvalue !== null) {\r\n                    if(departmentvalue > 0){\r\n                        var costcentervalue = 0;\r\n                    }else{\r\n                        var costcentervalue = $('#id_costcenterid').val();\r\n                    }\r\n                    $.ajax({\r\n                        method: \"GET\",\r\n                        dataType: \"json\",\r\n                        url: M.cfg.wwwroot + \"/local/forum/dept_ajax.php?action=groupslist&costcenter=\"+costcentervalue+\"&department=\"+departmentvalue,\r\n                        success: function(data){\r\n                            var template = '<option value=\"\">'+title+'</option>';\r\n                                $.each( data.data, function( index, value) {\r\n                                     template +=\t'<option value = ' + index + ' >' +value+ '</option>';\r\n                                });\r\n                            $(\"#id_local_group\").html(template);\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n            return new NewForum(args);\r\n        },\r\n        load: function(){},\r\n        deleteforum: function(elem) {\r\n            return Str.get_strings([{\r\n                key: 'delete',\r\n                component: 'local_forum'\r\n            }, {\r\n                key: 'deleteforum',\r\n                component: 'local_forum'\r\n            }]).then(function(s) {\r\n                ModalFactory.create({\r\n                    title: s[0],\r\n                    type: ModalFactory.types.DEFAULT,\r\n                    body: s[1],\r\n                    footer: '<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">'+M.util.get_string(\"yes\", \"moodle\")+'</button>&nbsp;' +\r\n        '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">'+M.util.get_string(\"no\", \"moodle\")+'</button>'\r\n                }).done(function(modal) {\r\n                    this.modal = modal;\r\n                    modal.getRoot().find('[data-action=\"save\"]').on('click', function() {\r\n                        window.location.href ='index.php?id='+elem+'&delete=1&sesskey=' + M.cfg.sesskey;\r\n                    }.bind(this));\r\n                    modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\r\n                        modal.setBody('');\r\n                        modal.hide();\r\n                    });\r\n                    modal.show();\r\n                }.bind(this));\r\n            }.bind(this));\r\n        },\r\n        load_datatable :function(tableid){\r\n            return Str.get_strings([{\r\n                key: 'noforums',\r\n                component: 'local_forum'\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\tkey: 'search',\r\n                component: 'local_forum'\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t]).then(function(s) {\r\n                $('#'+tableid).DataTable({\r\n                    'language': {\r\n                        \"zeroRecords\": s[0],\r\n                        'infoEmpty': s[0],\r\n                        'paginate': {\r\n                            'previous': '<',\r\n                            'next': '>'\r\n                        }\r\n                    },\r\n\t\t\t\t\t\"oLanguage\": {\r\n\t\t\t\t\t\"sSearch\": s[1]\r\n\t\t\t\t },\r\n                    order: []\r\n                });\r\n            });\r\n        },\r\n        \r\n    };\r\n});"],"file":"newforum.min.js"}