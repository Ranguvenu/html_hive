{"version":3,"sources":["../src/ajaxforms.js"],"names":["define","$","Str","ModalFactory","ModalEvents","Fragment","Ajax","Y","Templates","classroomlastchildpopup","args","params","classroomid","id","contextid","promise","call","methodname","done","returndata","data","render","response","then","create","title","get_string","body","modal","show","setLarge","getRoot","addClass","animate","on","hidden","setTimeout","destroy","bind","click","window","location","href","fail","ex","console","log","AjaxForms","init","prototype","self","callback","header_label","type","types","DEFAULT","getBody","footer","getFooter","find","submitForm","form_status","html","handleFormSubmissionResponse","setBody","css","document","instanceid","val","form","submitFormAjax","formdata","jsonformdata","JSON","stringify","loadFragment","component","buttonstring","$footer","$style","hide","use","M","core_formchangechecker","reset_form_dirty_state","reload","handleFormSubmissionFailure","e","preventDefault","formData","serialize","plugintype","pluginname","resp","submit","load"],"mappings":"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","sourcesContent":["/**\n * Add a create new group modal to the page.\n *\n * @module     core_group/AjaxForms\n * @class      AjaxForms\n * @package    core_group\n * @copyright  2017 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'core/str',\n        'core/modal_factory',\n        'core/modal_events',\n        'core/fragment',\n        'core/ajax',\n        'core/yui',\n        'core/templates',\n        'local_classroom/select2',\n        'local_classroom/classroom'],\n        function($, Str, ModalFactory, ModalEvents, Fragment, Ajax, Y, Templates, select2, Classroom) {\n\n    /**\n     * Constructor\n     *\n     * @param {String} selector used to find triggers for the new group modal.\n     * @param {int} contextid\n     *\n     * Each call to init gets it's own instance of this class.\n     */\n    classroomlastchildpopup=function(args) {\n            params = {classroomid : args.id, contextid : 1};\n\n            var promise = Ajax.call([{\n              methodname: 'local_classroom_classroomlastchildpopup',\n              args: params\n            }]);\n\n            promise[0].done(function(returndata) {\n              var data = Templates.render('local_classroom/classroomview', {response: returndata});\n                data.then(function(response){\n                    ModalFactory.create({\n                        title: Str.get_string('classroom_info', 'local_classroom'),\n                        body: response\n                      }).done(function(modal) {\n                        // Do what you want with your new modal.\n                        modal.show();\n                         modal.setLarge();\n                         modal.getRoot().addClass('openLMStransition');\n                            modal.getRoot().animate({\"right\":\"0%\"}, 500);\n                            modal.getRoot().on(ModalEvents.hidden, function() {\n                            modal.getRoot().animate({\"right\":\"-85%\"}, 500);\n                                    setTimeout(function(){\n                                    modal.destroy();\n                                }, 1000);\n                            }.bind(this));\n                            $(\".close\").click(function(){\n                                window.location.href =  window.location.href;\n                            });\n                      });\n                });\n                \n            }).fail(function(ex) {\n                // do something with the exception\n                console.log(ex);\n            });\n    };\n    var AjaxForms = function(args) {\n        this.contextid = args.contextid;\n        this.args = args;\n        this.init(args);\n    };\n\n    /**\n     * @var {Modal} modal\n     * @private\n     */\n    AjaxForms.prototype.modal = null;\n\n    /**\n     * @var {int} contextid\n     * @private\n     */\n    AjaxForms.prototype.contextid = -1;\n\n    /**\n     * Initialise the class.\n     *\n     * @param {String} selector used to find triggers for the new group modal.\n     * @private\n     * @return {Promise}\n     */\n    AjaxForms.prototype.init = function(args) {\n        // Fetch the title string.\n        var self = this;\n        switch (args.callback) {\n          case 'classroom_form':\n              switch (args.id) {\n                case 0:\n                  header_label='createclassroom';\n                  break;\n                default:\n                  header_label='updateclassroom';\n              }\n              break;\n          case 'session_form':\n            switch (args.id) {\n              case 0:\n                header_label='addsession';\n                break;\n              default:\n                header_label='updatesession';\n            }\n          break;\n          case 'course_form':\n            switch (args.id) {\n              case 0:\n                header_label='addcourses';\n                break;\n              default:\n                header_label='updatecourses';\n            }\n            break;\n          case 'classroom_completion_form':\n            header_label='classroom_completion_settings';\n            break;\n        }\n\n        return Str.get_string(header_label, 'local_classroom').then(function(title) {\n            // Create the modal.\n            return ModalFactory.create({\n                type: ModalFactory.types.DEFAULT,\n                title: title,\n                body: this.getBody(),\n                footer: this.getFooter(),\n            });\n        }.bind(this)).then(function(modal) {\n            // Keep a reference to the modal.\n            this.modal = modal;\n\n            // Forms are big, we want a big modal.\n            this.modal.setLarge();\n\n            this.modal.getRoot().addClass('openLMStransition local_classroom');\n\n            // We want to reset the form every time it is opened.\n            this.modal.getRoot().on(ModalEvents.hidden, function() {\n                this.modal.getRoot().animate({\"right\":\"-85%\"}, 500);\n                setTimeout(function(){\n                    modal.destroy();\n                }, 1000);\n                // this.modal.destroy();\n            }.bind(this));\n            this.modal.getFooter().find('[data-action=\"save\"]').on('click', this.submitForm.bind(this));\n            this.modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\n                window.location.href =  window.location.href;\n                //modal.hide();\n                //setTimeout(function(){\n                //    modal.destroy();\n                //}, 1000);\n                // modal.destroy();\n            });\n            this.modal.getFooter().find('[data-action=\"skip\"]').on('click', function() {\n                self.args.form_status = self.args.form_status + 1;\n                 //console.log(args.form_status);\n                 // OL-1042 Add Target Audience to Classrooms//\n                 // if (args.form_status == 4) {\n                // OL-1042 Add Target Audience to Classrooms//\n                    // classroomlastchildpopup(args);\n                 // }\n                var data = self.getBody();\n                data.then(function(html, js) {\n                    if (html === false) {\n                        // window.location.reload();\n                        self.handleFormSubmissionResponse(args);\n                        \n                    }\n                });\n                modal.setBody(data);\n                if(self.args.form_status == 3){\n                    $('[data-action=\"skip\"]').css('display', 'none');\n                }\n            });\n            this.modal.getFooter().find('[data-action=\"previous\"]').on('click', function() {\n                self.args.form_status = self.args.form_status - 1;\n                 //console.log(args.form_status);\n                 // OL-1042 Add Target Audience to Classrooms//\n                 // if (args.form_status == 4) {\n                // OL-1042 Add Target Audience to Classrooms//\n                    // classroomlastchildpopup(args);\n                 // }\n                var data = self.getBody();\n                data.then(function(html, js) {\n                    if (html === false) {\n                        // window.location.reload();\n                        self.handleFormSubmissionResponse(args);\n                        \n                    }\n                });\n                modal.setBody(data);\n                if (self.args.form_status == 0) {\n                    $('[data-action=\"skip\"]').css('display', 'none');\n                    $('[data-action=\"previous\"]').css('display', 'none');\n                }else if(self.args.form_status < 3){\n                    $('[data-action=\"skip\"]').css('display', 'inline-block');\n                    $('[data-action=\"previous\"]').css('display', 'inline-block');\n                }\n            });\n            // added for custom navigating from the top lists.\n            \n            if(self.args.callback == 'classroom_form'){\n                // if(instanceid > 0){\n                $(document).on('click', '.custom_classroom_form_redirect', function(){\n                    var instanceid = $(\"#classroomid\").val();\n                    if(instanceid > 0){\n                        self.args.form_status = $(this).data('value');\n                        var data = self.getBody();\n                        data.then(function(html, js) {\n                            if (html === false) {\n                              // window.location.reload();\n                                self.handleFormSubmissionResponse(args);\n                            }\n                        });\n                        modal.setBody(data);\n                        if (self.args.form_status == 0) {\n                            $('[data-action=\"skip\"]').css('display', 'none');\n                            $('[data-action=\"previous\"]').css('display', 'none');\n                        }else if(self.args.form_status < 4){\n                            $('[data-action=\"skip\"]').css('display', 'inline-block');\n                            $('[data-action=\"previous\"]').css('display', 'inline-block');\n                        }\n                    }\n                });\n            }\n            // added for custom navigating from the top lists ends here.\n            this.modal.getRoot().on('submit', 'form', function(form) {\n                self.submitFormAjax(form, self.args);\n            });\n            this.modal.show();\n            this.modal.getRoot().animate({\"right\":\"0%\"}, 500);\n            $(\".close\").click(function(){\n              window.location.href =  window.location.href;\n            });\n            return this.modal;\n        }.bind(this));\n    };\n\n    /**\n     * @method getBody\n     * @private\n     * @return {Promise}\n     */\n    AjaxForms.prototype.getBody = function(formdata) {\n        if (typeof formdata === \"undefined\") {\n            formdata = {};\n        }\n\n        // Get the content of the modal.\n        this.args.jsonformdata = JSON.stringify(formdata);\n        return Fragment.loadFragment(this.args.component, this.args.callback, this.contextid, this.args);\n    };\n    /**\n     * @method getFooter\n     * @private\n     * @return {Promise}\n     */\n    AjaxForms.prototype.getFooter = function() {\n      console.log(this.args);\n      if(this.args.callback == 'classroom_form'){\n        buttonstring = 'Save & Continue';\n      }else if(this.args.callback == 'course_form'){\n        buttonstring = 'Assign';\n      }else{\n        buttonstring = 'Save';\n      }\n        $footer = '<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">'+buttonstring+'</button>&nbsp;';\n        if (this.args.form_status == 0) {\n            $style = 'style=\"display:none;\"';\n            $footer += '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"previous\" ' + $style + '>Previous</button>&nbsp;';\n            $footer += '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"skip\" ' + $style + '>Skip</button>&nbsp;';\n        }\n        $footer += '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">Cancel</button>';\n        return $footer;\n    };\n    /**\n     * @method handleFormSubmissionResponse\n     * @private\n     * @return {Promise}\n     */\n    AjaxForms.prototype.handleFormSubmissionResponse = function(args) {\n        this.modal.hide();\n        // We could trigger an event instead.\n        // Yuk.\n        Y.use('moodle-core-formchangechecker', function() {\n            M.core_formchangechecker.reset_form_dirty_state();\n        });\n        if (args.form_status == -2 || args.form_status == 3 || args.callback == 'course_form') {\n            window.location.reload();\n        }\n        classroomlastchildpopup(args);\n    };\n\n    /**\n     * @method handleFormSubmissionFailure\n     * @private\n     * @return {Promise}\n     */\n    AjaxForms.prototype.handleFormSubmissionFailure = function(data) {\n        // Oh noes! Epic fail :(\n        // Ah wait - this is normal. We need to re-display the form with errors!\n        this.modal.setBody(this.getBody(data));\n    };\n\n    /**\n     * Private method\n     *\n     * @method submitFormAjax\n     * @private\n     * @param {Event} e Form submission event.\n     */\n    AjaxForms.prototype.submitFormAjax = function(e, args) {\n        // We don't want to do a real form submission.\n        e.preventDefault();\n        var self = this;\n        // Convert all the form elements values to a serialised string.\n        var formData = this.modal.getRoot().find('form').serialize();\n        var methodname = args.plugintype + '_' + args.pluginname + '_submit_instance';\n        // Now we can continue...\n        var params = {};\n        params.contextid = this.contextid;\n        params.jsonformdata = JSON.stringify(formData);\n        params.form_status = args.form_status;\n\n        var promise = Ajax.call([{\n            methodname: methodname,\n            args: params\n        }]);\n        promise[0].done(function(resp){\n            self.args.form_status = resp.form_status;\n            if (resp.form_status >= 0 && resp.form_status !== false) {\n                self.args.form_status = resp.form_status;\n                self.args.id = resp.id;\n                self.handleFormSubmissionFailure();\n            } else {\n                self.handleFormSubmissionResponse(self.args);\n            }\n            if (args.form_status > 0) {\n                $('[data-action=\"skip\"]').css('display', 'inline-block');\n                $('[data-action=\"previous\"]').css('display', 'inline-block');\n            }\n            if (args.form_status == 3 ) {\n                $('[data-action=\"skip\"]').css('display', 'none');\n            }\n            \n        }).fail(function(ex){\n            self.handleFormSubmissionFailure(formData);\n        });\n\n    };\n\n    /**\n     * This triggers a form submission, so that any mform elements can do final tricks before the form submission is processed.\n     *\n     * @method submitForm\n     * @param {Event} e Form submission event.\n     * @private\n     */\n    AjaxForms.prototype.submitForm = function(e) {\n        e.preventDefault();\n        this.modal.getRoot().find('form').submit();\n    };\n\n    return /** @alias module:core_group/AjaxForms */ {\n        // Public variables and functions.\n        /**\n         * Attach event listeners to initialise this module.\n         *\n         * @method init\n         * @param {string} selector The CSS selector used to find nodes that will trigger this module.\n         * @param {int} contextid The contextid for the course.\n         * @return {Promise}\n         */\n        init: function(args) {\n            return new AjaxForms(args);\n        },\n        load: function () {\n\n        }\n    };\n});"],"file":"ajaxforms.min.js"}