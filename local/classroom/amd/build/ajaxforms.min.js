define ("local_classroom/ajaxforms",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","core/templates","local_classroom/select2","local_classroom/classroom"],function(a,b,c,d,e,f,g,h){classroomlastchildpopup=function classroomlastchildpopup(e){params={classroomid:e.id,contextid:1};var g=f.call([{methodname:"local_classroom_classroomlastchildpopup",args:params}]);g[0].done(function(e){var f=h.render("local_classroom/classroomview",{response:e});f.then(function(e){c.create({title:b.get_string("classroom_info","local_classroom"),body:e}).done(function(b){b.show();b.setLarge();b.getRoot().addClass("openLMStransition");b.getRoot().animate({right:"0%"},500);b.getRoot().on(d.hidden,function(){b.getRoot().animate({right:"-85%"},500);setTimeout(function(){b.destroy()},1e3)}.bind(this));a(".close").click(function(){window.location.href=window.location.href})})})}).fail(function(a){console.log(a)})};var i=function(a){this.contextid=a.contextid;this.args=a;this.init(a)};i.prototype.modal=null;i.prototype.contextid=-1;i.prototype.init=function(e){var f=this;switch(e.callback){case"classroom_form":switch(e.id){case 0:header_label="createclassroom";break;default:header_label="updateclassroom";}break;case"session_form":switch(e.id){case 0:header_label="addsession";break;default:header_label="updatesession";}break;case"course_form":switch(e.id){case 0:header_label="addcourses";break;default:header_label="updatecourses";}break;case"classroom_completion_form":header_label="classroom_completion_settings";break;}return b.get_string(header_label,"local_classroom").then(function(a){return c.create({type:c.types.DEFAULT,title:a,body:this.getBody(),footer:this.getFooter()})}.bind(this)).then(function(b){this.modal=b;this.modal.setLarge();this.modal.getRoot().addClass("openLMStransition local_classroom");this.modal.getRoot().on(d.hidden,function(){this.modal.getRoot().animate({right:"-85%"},500);setTimeout(function(){b.destroy()},1e3)}.bind(this));this.modal.getFooter().find("[data-action=\"save\"]").on("click",this.submitForm.bind(this));this.modal.getFooter().find("[data-action=\"cancel\"]").on("click",function(){window.location.href=window.location.href});this.modal.getFooter().find("[data-action=\"skip\"]").on("click",function(){f.args.form_status=f.args.form_status+1;var c=f.getBody();c.then(function(a){if(!1===a){f.handleFormSubmissionResponse(e)}});b.setBody(c);if(3==f.args.form_status){a("[data-action=\"skip\"]").css("display","none")}});this.modal.getFooter().find("[data-action=\"previous\"]").on("click",function(){f.args.form_status=f.args.form_status-1;var c=f.getBody();c.then(function(a){if(!1===a){f.handleFormSubmissionResponse(e)}});b.setBody(c);if(0==f.args.form_status){a("[data-action=\"skip\"]").css("display","none");a("[data-action=\"previous\"]").css("display","none")}else if(3>f.args.form_status){a("[data-action=\"skip\"]").css("display","inline-block");a("[data-action=\"previous\"]").css("display","inline-block")}});if("classroom_form"==f.args.callback){a(document).on("click",".custom_classroom_form_redirect",function(){var c=a("#classroomid").val();if(0<c){f.args.form_status=a(this).data("value");var d=f.getBody();d.then(function(a){if(!1===a){f.handleFormSubmissionResponse(e)}});b.setBody(d);if(0==f.args.form_status){a("[data-action=\"skip\"]").css("display","none");a("[data-action=\"previous\"]").css("display","none")}else if(4>f.args.form_status){a("[data-action=\"skip\"]").css("display","inline-block");a("[data-action=\"previous\"]").css("display","inline-block")}}})}this.modal.getRoot().on("submit","form",function(a){f.submitFormAjax(a,f.args)});this.modal.show();this.modal.getRoot().animate({right:"0%"},500);a(".close").click(function(){window.location.href=window.location.href});return this.modal}.bind(this))};i.prototype.getBody=function(a){if("undefined"==typeof a){a={}}this.args.jsonformdata=JSON.stringify(a);return e.loadFragment(this.args.component,this.args.callback,this.contextid,this.args)};i.prototype.getFooter=function(){console.log(this.args);if("classroom_form"==this.args.callback){buttonstring="Save & Continue"}else if("course_form"==this.args.callback){buttonstring="Assign"}else{buttonstring="Save"}$footer="<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">"+buttonstring+"</button>&nbsp;";if(0==this.args.form_status){$style="style=\"display:none;\"";$footer+="<button type=\"button\" class=\"btn btn-secondary\" data-action=\"previous\" "+$style+">Previous</button>&nbsp;";$footer+="<button type=\"button\" class=\"btn btn-secondary\" data-action=\"skip\" "+$style+">Skip</button>&nbsp;"}$footer+="<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">Cancel</button>";return $footer};i.prototype.handleFormSubmissionResponse=function(a){this.modal.hide();g.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()});if(-2==a.form_status||3==a.form_status||"course_form"==a.callback){window.location.reload()}classroomlastchildpopup(a)};i.prototype.handleFormSubmissionFailure=function(a){this.modal.setBody(this.getBody(a))};i.prototype.submitFormAjax=function(b,c){b.preventDefault();var d=this,e=this.modal.getRoot().find("form").serialize(),g=c.plugintype+"_"+c.pluginname+"_submit_instance",h={};h.contextid=this.contextid;h.jsonformdata=JSON.stringify(e);h.form_status=c.form_status;var i=f.call([{methodname:g,args:h}]);i[0].done(function(b){d.args.form_status=b.form_status;if(0<=b.form_status&&!1!==b.form_status){d.args.form_status=b.form_status;d.args.id=b.id;d.handleFormSubmissionFailure()}else{d.handleFormSubmissionResponse(d.args)}if(0<c.form_status){a("[data-action=\"skip\"]").css("display","inline-block");a("[data-action=\"previous\"]").css("display","inline-block")}if(3==c.form_status){a("[data-action=\"skip\"]").css("display","none")}}).fail(function(){d.handleFormSubmissionFailure(e)})};i.prototype.submitForm=function(a){a.preventDefault();this.modal.getRoot().find("form").submit()};return{init:function init(a){return new i(a)},load:function load(){}}});
//# sourceMappingURL=ajaxforms.min.js.map
