$(document).ready(function() {
    $("a").removeAttr("style");
    $('#calendar').fullCalendar({
        dayNamesShort: ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'],
        header: {
            left: '',
            center: 'prev title next',
            right: ''
        },
        weekends: true,
        themeSystem:'bootstrap3',
        fixedWeekCount: false,
        eventLimit: true,
        axisFormat: 'h:mm',
        defaultDate: new Date(),
        selectable: true,
        defaultView: 'month',
        events: $.ajax({
                method: "GET",
                dataType: "json",
                url: M.cfg.wwwroot + '/blocks/my_event_calendar/events.php',
                success: function (event) {
                    $("#eventInfo").html(event);
                        $(".event_table").DataTable({
                            'language': {
                                'paginate': {
                                    'previous': '<',
                                    'next': '>'
                                },
                                "emptyTable": "No events scheduled",
                            },
                        'bFilter': false,
                        'bInfo': false,
                        'pageLength': 4,

                        });
                    $('#EventDate').html('');
                    
                }
            }),
        cache: true,
        events: M.cfg.wwwroot + '/blocks/my_event_calendar/events.php?text=default',
        eventRender: function eventRender(event,view) {
            dt = new Date();
            var resp = '';
            var dateString = moment(event.start).format('YYYY-MM-DD');
            $('#calendar').find('.fc-day-top[data-date="' + dateString + '"]').addClass(event.plugin);
        },
        viewRender: function(view){
            dt = new Date();
            if ( moment(dt).format('MMM YYYY') == view.title) {
                if (($( "#eventInfo" ).hasClass( "hasevent" ))) {
                    $("#pop_desc").css("display", "none");
                } else {
                    $("#pop_desc").css("display", "block");                         
                }
            }
            
        },
        dayClick: function(date) {
            var datein_style = moment(date._i).format('YYYY-MM-DD');
            $("#pop_desc").css("display", "none");
            $.ajax({
                method: "GET",
                dataType: "json",
                url: M.cfg.wwwroot + '/blocks/my_event_calendar/events.php?start='+datein_style+'&end='+datein_style,
                success: function (event) {
                    
                    $("#eventInfo").html(event);
                        $(".event_table").DataTable({
                            'language': {
                                'paginate': {
                                    'previous': '<',
                                    'next': '>'
                                },
                                "emptyTable": "No events scheduled",
                            },
                        'bFilter': false,
                        'bInfo': false,
                        'pageLength': 4,

                        });
                    $('#EventDate').html('');
                    
                }
            });
        },
        loading: function(bool) {
            if (bool)
            $('#loading').show();
            else
            $('#loading').hide();

        }
    });
});
$(document).ready(function() {
    if ($(this).hasClass('fc-event-container')) {
        $(this).closest('.nav-column').siblings('div.home').toggleClass("off");
    }
    $(".fc-next-button").click(function() {
        $('#EventDate').html('');
        $('#eventInfo').html('');
    });
    $(".fc-prev-button").click(function() {
        $('#EventDate').html('');
        $('#eventInfo').html('');
    });
});

